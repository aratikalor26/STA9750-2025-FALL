<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arati Kalor">
<meta name="dcterms.date" content="2025-10-31">

<title>Mini-Project #02 - Making Backyards Affordable for All – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4c56c3815e56258fca96f833e48da355.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#data-reproducibility-notes" id="toc-data-reproducibility-notes" class="nav-link" data-scroll-target="#data-reproducibility-notes">Data &amp; Reproducibility Notes</a></li>
  <li><a href="#data-acquisition-acs-via-tidycensus" id="toc-data-acquisition-acs-via-tidycensus" class="nav-link" data-scroll-target="#data-acquisition-acs-via-tidycensus">Data Acquisition (ACS via <code>tidycensus</code>)</a></li>
  <li><a href="#task-1-data-acquisition-and-setup" id="toc-task-1-data-acquisition-and-setup" class="nav-link" data-scroll-target="#task-1-data-acquisition-and-setup">Task 1: Data Acquisition and Setup</a>
  <ul class="collapse">
  <li><a href="#building-permits-census-construction" id="toc-building-permits-census-construction" class="nav-link" data-scroll-target="#building-permits-census-construction">Building Permits (Census Construction)</a></li>
  <li><a href="#industry-codes-bls-naics" id="toc-industry-codes-bls-naics" class="nav-link" data-scroll-target="#industry-codes-bls-naics">Industry Codes (BLS NAICS)</a></li>
  <li><a href="#employment-wages-bls-qcew" id="toc-employment-wages-bls-qcew" class="nav-link" data-scroll-target="#employment-wages-bls-qcew">Employment &amp; Wages (BLS QCEW)</a></li>
  </ul></li>
  <li><a href="#task-2-data-cleaning-and-integration" id="toc-task-2-data-cleaning-and-integration" class="nav-link" data-scroll-target="#task-2-data-cleaning-and-integration">Task 2: Data Cleaning and Integration</a></li>
  <li><a href="#data-relationship-diagram" id="toc-data-relationship-diagram" class="nav-link" data-scroll-target="#data-relationship-diagram">Data Relationship Diagram</a></li>
  <li><a href="#data-integration-initial-exploration" id="toc-data-integration-initial-exploration" class="nav-link" data-scroll-target="#data-integration-initial-exploration">Data Integration &amp; Initial Exploration</a>
  <ul class="collapse">
  <li><a href="#q2.1---which-cbsa-permitted-the-most-20102019" id="toc-q2.1---which-cbsa-permitted-the-most-20102019" class="nav-link" data-scroll-target="#q2.1---which-cbsa-permitted-the-most-20102019">Q2.1 - Which CBSA permitted the most (2010–2019)?</a></li>
  <li><a href="#q2.2---albuquerque-cbsa-10740-year-with-most-permits" id="toc-q2.2---albuquerque-cbsa-10740-year-with-most-permits" class="nav-link" data-scroll-target="#q2.2---albuquerque-cbsa-10740-year-with-most-permits">Q2.2 - Albuquerque (CBSA 10740): year with most permits</a></li>
  <li><a href="#q2.3---which-state-had-the-highest-avg-individual-income-in-2015" id="toc-q2.3---which-state-had-the-highest-avg-individual-income-in-2015" class="nav-link" data-scroll-target="#q2.3---which-state-had-the-highest-avg-individual-income-in-2015">Q2.3 - Which state had the highest avg individual income in 2015?</a></li>
  <li><a href="#q2.4---which-cbsa-led-in-data-scientists-naics-5182-each-year" id="toc-q2.4---which-cbsa-led-in-data-scientists-naics-5182-each-year" class="nav-link" data-scroll-target="#q2.4---which-cbsa-led-in-data-scientists-naics-5182-each-year">Q2.4 - Which CBSA led in Data Scientists (NAICS 5182) each year?</a></li>
  <li><a href="#q2.5---nyc-finance-insurance-naics-52-wage-share-peak-year" id="toc-q2.5---nyc-finance-insurance-naics-52-wage-share-peak-year" class="nav-link" data-scroll-target="#q2.5---nyc-finance-insurance-naics-52-wage-share-peak-year">Q2.5 - NYC: Finance &amp; Insurance (NAICS 52) wage share &amp; peak year</a></li>
  </ul></li>
  <li><a href="#task-3-initial-visualizations" id="toc-task-3-initial-visualizations" class="nav-link" data-scroll-target="#task-3-initial-visualizations">Task 3: Initial Visualizations</a>
  <ul class="collapse">
  <li><a href="#rent-vs.-income-cbsa-2009" id="toc-rent-vs.-income-cbsa-2009" class="nav-link" data-scroll-target="#rent-vs.-income-cbsa-2009">3.1 - Rent vs.&nbsp;Income (CBSA, 2009)</a></li>
  <li><a href="#health-care-employment-vs.-total-employment-faceted-by-year" id="toc-health-care-employment-vs.-total-employment-faceted-by-year" class="nav-link" data-scroll-target="#health-care-employment-vs.-total-employment-faceted-by-year">3.2 - Health Care Employment vs.&nbsp;Total Employment (faceted by year)</a></li>
  <li><a href="#household-size-over-time-top-10-cbsas" id="toc-household-size-over-time-top-10-cbsas" class="nav-link" data-scroll-target="#household-size-over-time-top-10-cbsas">3.3 - Household Size Over Time (Top-10 CBSAs)</a></li>
  </ul></li>
  <li><a href="#task-4-rent-burden-index-rbi" id="toc-task-4-rent-burden-index-rbi" class="nav-link" data-scroll-target="#task-4-rent-burden-index-rbi">Task 4: Rent Burden Index (RBI)</a>
  <ul class="collapse">
  <li><a href="#rent-burden-spotlight-new-york-city-metro" id="toc-rent-burden-spotlight-new-york-city-metro" class="nav-link" data-scroll-target="#rent-burden-spotlight-new-york-city-metro">Rent Burden Spotlight: New York City Metro</a></li>
  <li><a href="#rent-burden-extremes-most-vs.-least-burdened-cbsas-latest-year" id="toc-rent-burden-extremes-most-vs.-least-burdened-cbsas-latest-year" class="nav-link" data-scroll-target="#rent-burden-extremes-most-vs.-least-burdened-cbsas-latest-year">Rent Burden Extremes: Most vs.&nbsp;Least Burdened CBSAs (Latest Year)</a></li>
  </ul></li>
  <li><a href="#task-5-housing-growth-metrics-hgi" id="toc-task-5-housing-growth-metrics-hgi" class="nav-link" data-scroll-target="#task-5-housing-growth-metrics-hgi">Task 5: Housing Growth Metrics (HGI)</a>
  <ul class="collapse">
  <li><a href="#instantaneous-building-index---permits-per-1000-residents" id="toc-instantaneous-building-index---permits-per-1000-residents" class="nav-link" data-scroll-target="#instantaneous-building-index---permits-per-1000-residents">Instantaneous Building Index - Permits per 1,000 Residents</a></li>
  <li><a href="#rate-based-building-index---permits-per-1000-new-residents" id="toc-rate-based-building-index---permits-per-1000-new-residents" class="nav-link" data-scroll-target="#rate-based-building-index---permits-per-1000-new-residents">Rate-based Building Index - Permits per 1,000 New Residents</a></li>
  <li><a href="#composite-building-friendliness-index-inst-rate-blend" id="toc-composite-building-friendliness-index-inst-rate-blend" class="nav-link" data-scroll-target="#composite-building-friendliness-index-inst-rate-blend">Composite Building-Friendliness Index (Inst + Rate Blend)</a></li>
  <li><a href="#rolling-5-year-average---smoothed-view-of-housing-growth" id="toc-rolling-5-year-average---smoothed-view-of-housing-growth" class="nav-link" data-scroll-target="#rolling-5-year-average---smoothed-view-of-housing-growth">Rolling 5-Year Average - Smoothed View of Housing Growth</a></li>
  </ul></li>
  <li><a href="#task-6-yimby-lens---relating-rent-burden-to-housing-growth" id="toc-task-6-yimby-lens---relating-rent-burden-to-housing-growth" class="nav-link" data-scroll-target="#task-6-yimby-lens---relating-rent-burden-to-housing-growth">Task 6: YIMBY Lens - Relating Rent Burden to Housing Growth</a>
  <ul class="collapse">
  <li><a href="#merge-panels-rbi-housing-growth" id="toc-merge-panels-rbi-housing-growth" class="nav-link" data-scroll-target="#merge-panels-rbi-housing-growth">Merge Panels (RBI + Housing Growth)</a></li>
  <li><a href="#cross-section-latest-year-housing-growth-vs.-rent-burden" id="toc-cross-section-latest-year-housing-growth-vs.-rent-burden" class="nav-link" data-scroll-target="#cross-section-latest-year-housing-growth-vs.-rent-burden">Cross-Section (Latest Year): Housing Growth vs.&nbsp;Rent Burden</a></li>
  <li><a href="#trends-over-time-rent-burden-for-selected-cbsas" id="toc-trends-over-time-rent-burden-for-selected-cbsas" class="nav-link" data-scroll-target="#trends-over-time-rent-burden-for-selected-cbsas">Trends Over Time: Rent Burden for Selected CBSAs</a></li>
  <li><a href="#shortlist-potential-yimby-success-cbsas" id="toc-shortlist-potential-yimby-success-cbsas" class="nav-link" data-scroll-target="#shortlist-potential-yimby-success-cbsas">Shortlist: Potential YIMBY Success CBSAs</a></li>
  </ul></li>
  <li><a href="#task-7-policy-brief---building-backyards-for-all" id="toc-task-7-policy-brief---building-backyards-for-all" class="nav-link" data-scroll-target="#task-7-policy-brief---building-backyards-for-all">Task 7: Policy Brief - Building Backyards for All</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Mini-Project #02 - Making Backyards Affordable for All</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arati Kalor <a href="mailto:arati.kalor@baruchmail.cuny.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 31, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive Summary</h2>
<p>Housing affordability is a persistent challenge across U.S. metros. Using ACS (income, rent, population, households), Census Building Permits, and BLS QCEW wages/employment, I construct (i) a <strong>Rent Burden Index</strong> (share of household income paid in rent, scaled 0–100) and (ii) a <strong>Housing Growth Composite</strong> (permits per capita + permits vs.&nbsp;5-yr population growth, both scaled 0–100). I also add a <strong>Millennial Appeal Index (MAI)</strong> (youthfulness + arts/amenities employment).</p>
<p><strong>Key findings (preview):</strong> - Metros with <strong>sustained permitting</strong> tend to show <strong>lower rent burden</strong> in recent years. - “YIMBY-leaning” CBSAs combine <strong>falling rent burden</strong>, <strong>population growth</strong>, and <strong>above-average housing growth</strong>.</p>
<p><strong>Recommendation:</strong> A federal <strong>YIMBY Incentive Program</strong> that channels grants toward metros demonstrating falling rent burden, healthy population growth, and sustained permitting.</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data/mp02/Backyard.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="border-radius:18px; box-shadow:0 0 12px rgba(0,0,0,0.25); transition: all 0.3s ease-in-out;;width:85.0%"></p>
</figure>
</div>
<p><em>Figure: Livable housing and backyard spaces — connecting affordability with quality of life. Inspired by “Building Backyards for All.”</em></p>
</section>
<section id="data-reproducibility-notes" class="level2">
<h2 class="anchored" data-anchor-id="data-reproducibility-notes">Data &amp; Reproducibility Notes</h2>
<p>All data are downloaded and cached locally under <code>data/mp02/</code>. Year 2020 is excluded to match ACS1 coverage. I standardize cross-source CBSA keys to enable joins. Visuals are intended for non-technical readers; code is shown for transparency.</p>
</section>
<section id="data-acquisition-acs-via-tidycensus" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition-acs-via-tidycensus">Data Acquisition (ACS via <code>tidycensus</code>)</h2>
<p>I pull ACS1 (2009–2023, excl. 2020) at <strong>CBSA</strong> level: - <strong>Income:</strong> <code>B19013_001</code> (median household income)<br>
- <strong>Rent:</strong> <code>B25064_001</code> (median gross rent)<br>
- <strong>Population:</strong> <code>B01003_001</code><br>
- <strong>Households:</strong> <code>B11001_001</code></p>
</section>
<section id="task-1-data-acquisition-and-setup" class="level2">
<h2 class="anchored" data-anchor-id="task-1-data-acquisition-and-setup">Task 1: Data Acquisition and Setup</h2>
<p>I collected data from three main public sources using R packages such as tidycensus, httr2, and rvest.</p>
<p>From the American Community Survey (ACS), I gathered data on income, rent, population, and households (2009–2023, excluding 2020) at the CBSA level to measure affordability.</p>
<p>The Census Building Permits Survey provided annual counts of new housing units permitted, indicating construction trends.</p>
<p>The BLS QCEW dataset offered employment and wage data across industries to link housing with economic activity.</p>
<p>All datasets were cleaned, standardized using a std_cbsa key, and stored in data/mp02/ for analysis.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data ingest (ACS via tidycensus).</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyverse)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(glue)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidycensus)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a consistent, publication-ready theme</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"line"</span>, <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"point"</span>, <span class="fu">list</span>(<span class="at">size =</span> <span class="fl">1.8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="building-permits-census-construction" class="level3">
<h3 class="anchored" data-anchor-id="building-permits-census-construction">Building Permits (Census Construction)</h3>
<p>I parse historical TXT (≤2018) and current XLS files (2019+), harmonizing to CBSA/year and total units permitted.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="industry-codes-bls-naics" class="level3">
<h3 class="anchored" data-anchor-id="industry-codes-bls-naics">Industry Codes (BLS NAICS)</h3>
<p>I scrape BLS NAICS titles to help interpret sector codes for QCEW employment/wage analysis.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time cleanup for failed QCEW downloads</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>,<span class="st">"mp02"</span>), <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the combined cache so it rebuilds</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>qcew_bundle <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>,<span class="st">"mp02"</span>,<span class="st">"bls_qcew_2009_2023.csv.gz"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the specific year zip files that failed</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>bad_zips <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>,<span class="st">"mp02"</span>, <span class="fu">c</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015_qcew_annual_singlefile.zip"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2017_qcew_annual_singlefile.zip"</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">c</span>(qcew_bundle, bad_zips))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
</section>
<section id="employment-wages-bls-qcew" class="level3">
<h3 class="anchored" data-anchor-id="employment-wages-bls-qcew">Employment &amp; Wages (BLS QCEW)</h3>
<p>I load annual single-file ZIPs for 2009–2023 (excl. 2020) and keep CBSA-level totals by industry, building an average wage and employment base for later joins.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(area_fips, </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="task-2-data-cleaning-and-integration" class="level2">
<h2 class="anchored" data-anchor-id="task-2-data-cleaning-and-integration">Task 2: Data Cleaning and Integration</h2>
<p>I standardized GEOID, CBSA, and YEAR fields across all datasets to ensure consistent joins. For ACS tables (income, rent, population, households), I created a unified key called std_cbsa using the GEOID, while the same was done for Building Permits and BLS data using CBSA or FIPS codes. After aligning these keys, I performed inner joins to combine datasets by year and metro area, removed missing values, and verified that each table covered the same year range. This cleaned and integrated data formed the base for building the indices and visualizations shown next.</p>
</section>
<section id="data-relationship-diagram" class="level2">
<h2 class="anchored" data-anchor-id="data-relationship-diagram">Data Relationship Diagram</h2>
<p>The diagram below shows how ACS tables join on <code>GEOID/year</code>, permits join on <code>CBSA/year</code>, and BLS QCEW joins after creating compatible CBSA keys (<code>std_cbsa</code>).</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data/mp02/mp02_relationship_diagram.png" class="img-fluid figure-img" width="568"></p>
<figcaption>Figure 1. Data Relationship Diagram showing linkages among ACS, Census, and BLS datasets.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="data-integration-initial-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-integration-initial-exploration">Data Integration &amp; Initial Exploration</h2>
<p>I standardize cross-source keys: - ACS (INCOME/RENT/POPULATION/HOUSEHOLDS): <code>std_cbsa = paste0("C", GEOID)</code> - PERMITS: <code>std_cbsa = paste0("C", CBSA)</code> - QCEW: <code>std_cbsa = paste0(FIPS, "0")</code></p>
<p>I then answer a few warm-up questions to confirm coverage and joins.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize CBSA IDs between ACS (tidycensus) and BLS/QCEW tables ----</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Make standardized CBSA keys for Census (ACS / Permits)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> RENT     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, CBSA))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Make standardized CBSA keys for BLS/QCEW tables</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="q2.1---which-cbsa-permitted-the-most-20102019" class="level3">
<h3 class="anchored" data-anchor-id="q2.1---which-cbsa-permitted-the-most-20102019">Q2.1 - Which CBSA permitted the most (2010–2019)?</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA permitting the most new housing units (2010–2019)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>permits_2010_2019 <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_units))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>top_cbsa <span class="ot">&lt;-</span> permits_2010_2019 <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>top_cbsa</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["std_cbsa"],"name":[1],"type":["chr"],"align":["left"]},{"label":["total_units"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"C26420","2":"482075"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="q2.2---albuquerque-cbsa-10740-year-with-most-permits" class="level3">
<h3 class="anchored" data-anchor-id="q2.2---albuquerque-cbsa-10740-year-with-most-permits">Q2.2 - Albuquerque (CBSA 10740): year with most permits</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Albuquerque CBSA (10740): Year with most permits</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>albq <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(new_housing_units_permitted)) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>albq</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["CBSA"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["new_housing_units_permitted"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["year"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["std_cbsa"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"10740","2":"4021","3":"2021","4":"C10740"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="q2.3---which-state-had-the-highest-avg-individual-income-in-2015" class="level3">
<h3 class="anchored" data-anchor-id="q2.3---which-state-had-the-highest-avg-individual-income-in-2015">Q2.3 - Which state had the highest avg individual income in 2015?</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute per-state average individual income (2015)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>income_2015 <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, std_cbsa, household_income) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POPULATION <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the two-letter state at end of NAME (no comma)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">"[A-Z]{2}$"</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_income =</span> household_income <span class="sc">*</span> households) <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop    =</span> <span class="fu">sum</span>(population,    <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_pop</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>income_2015 <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["state"],"name":[1],"type":["chr"],"align":["left"]},{"label":["total_income"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["total_pop"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["avg_individual_income"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"6.218728e+12","3":"290032000","4":"21441.52"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="q2.4---which-cbsa-led-in-data-scientists-naics-5182-each-year" class="level3">
<h3 class="anchored" data-anchor-id="q2.4---which-cbsa-led-in-data-scientists-naics-5182-each-year">Q2.4 - Which CBSA led in Data Scientists (NAICS 5182) each year?</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA with most Data Scientists (NAICS 5182)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data_sci <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_ds =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(YEAR, <span class="fu">desc</span>(total_ds))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Find which CBSA led each year</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>leaders <span class="ot">&lt;-</span> data_sci <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> total_ds, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># NYC CBSA last year leading</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>leaders <span class="sc">|&gt;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(std_cbsa, <span class="st">"35620"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> YEAR)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["std_cbsa"],"name":[1],"type":["chr"],"align":["left"]},{"label":["YEAR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["total_ds"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"C35620","2":"2009","3":"16349"},{"1":"C35620","2":"2012","3":"14423"},{"1":"C35620","2":"2013","3":"14251"},{"1":"C35620","2":"2014","3":"17828"},{"1":"C35620","2":"2015","3":"18922"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="q2.5---nyc-finance-insurance-naics-52-wage-share-peak-year" class="level3">
<h3 class="anchored" data-anchor-id="q2.5---nyc-finance-insurance-naics-52-wage-share-peak-year">Q2.5 - NYC: Finance &amp; Insurance (NAICS 52) wage share &amp; peak year</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fraction of NYC wages from Finance &amp; Insurance</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>nyc_fin <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(std_cbsa, <span class="st">"35620"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin_share =</span> fin_wages <span class="sc">/</span> total_wages</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(fin_share))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>nyc_fin <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["YEAR"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["total_wages"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["fin_wages"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["fin_share"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2014","2":"2.587097e+12","3":"119105615711","4":"0.04603833"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="task-3-initial-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="task-3-initial-visualizations">Task 3: Initial Visualizations</h2>
<p>Below, I visualize relationships to build intuition about affordability and sector composition.</p>
<section id="rent-vs.-income-cbsa-2009" class="level3">
<h3 class="anchored" data-anchor-id="rent-vs.-income-cbsa-2009">3.1 - Rent vs.&nbsp;Income (CBSA, 2009)</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge 2009 ACS data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>rent_income_2009 <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, monthly_rent),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden =</span> monthly_rent <span class="sc">/</span> (household_income <span class="sc">/</span> <span class="dv">12</span>)  <span class="co"># ratio of rent to income</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorful scatterplot</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rent_income_2009,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> household_income,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> monthly_rent,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> rent_burden)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#E4572E"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"C"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Rent Burden</span><span class="sc">\n</span><span class="st">(share of income)"</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income (CBSA, 2009)"</span>,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Color shows rent burden — ratio of rent to income"</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Median Household Income (USD)"</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median Monthly Rent (USD)"</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/v-rent-vs-income-2009-1.png" class="img-fluid figure-img" width="1760"></p>
<figcaption>Figure 3A. Monthly Rent vs Household Income (CBSA, 2009)</figcaption>
</figure>
</div>
</div>
</div>
<p>💡 <strong>Interpretation:</strong><br>
This scatterplot shows how higher-income CBSAs tend to have higher rents but often <strong>lower rent burdens</strong> (shown by lighter colors).<br>
Conversely, darker points represent cities where residents spend a larger share of income on rent — indicating housing stress.</p>
</section>
<section id="health-care-employment-vs.-total-employment-faceted-by-year" class="level3">
<h3 class="anchored" data-anchor-id="health-care-employment-vs.-total-employment-faceted-by-year">3.2 - Health Care Employment vs.&nbsp;Total Employment (faceted by year)</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>wages_cbsa_year_subset <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(YEAR <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>             <span class="co"># odd years: 2009, 2011, …, 2023</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="at">emp_total  =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="at">emp_health =</span> <span class="fu">sum</span>(EMPLOYMENT[<span class="fu">startsWith</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"62"</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">health_share =</span> emp_health <span class="sc">/</span> emp_total)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wages_cbsa_year_subset, <span class="fu">aes</span>(<span class="at">x =</span> emp_total, <span class="at">y =</span> emp_health, <span class="at">color =</span> health_share)) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="at">option =</span> <span class="st">"magma"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="at">name =</span> <span class="st">"Health sector share"</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()) <span class="co"># 10M, 20M…</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>())</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"Health Care &amp; Social Assistance Employment vs. Total Employment"</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"CBSAs, faceted by year (NAICS 62) • Color shows health-sector share of total employment"</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Total Employment (All Industries)"</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Employment in Health Care &amp; Social Assistance (NAICS 62)"</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">18</span>, <span class="dv">6</span>, <span class="dv">6</span>)   <span class="co"># extra room for the colorbar</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/v-healthshare-over-time-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="household-size-over-time-top-10-cbsas" class="level3">
<h3 class="anchored" data-anchor-id="household-size-over-time-top-10-cbsas">3.3 - Household Size Over Time (Top-10 CBSAs)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridisLite)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Build base table</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>hhsize_base <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_size =</span> population <span class="sc">/</span> households,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short =</span> <span class="fu">str_remove</span>(NAME, <span class="st">",.*$"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># collapse CBSAs with same root name (e.g. Atlanta variants)</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME_short, year) <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_size =</span> <span class="fu">mean</span>(hh_size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Find top 10 CBSAs by latest population</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(hhsize_base<span class="sc">$</span>year)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> hhsize_base <span class="sc">%&gt;%</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(population, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(NAME_short)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>hhsize_top <span class="ot">&lt;-</span> hhsize_base <span class="sc">%&gt;%</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME_short <span class="sc">%in%</span> top10)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorful line plot</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hhsize_top, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hh_size, <span class="at">group =</span> NAME_short, <span class="at">color =</span> NAME_short)) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">end =</span> <span class="fl">0.9</span>,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Household Size Over Time"</span>,</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Top 10 CBSAs by population (cleaned names)"</span>,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Average Household Size"</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/v-household-size-colorful-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Figure 3. Average Household Size Over Time (Top 10 CBSAs, Cleaned)</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(ggnewscale)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(ggrepel)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Base table</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>hhsize_all <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_size    =</span> population <span class="sc">/</span> households,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Full names to pick the two CBSAs</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>highlight_full <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Los Angeles-Long Beach-Anaheim, CA Metro Area"</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>yr_min <span class="ot">&lt;-</span> <span class="fu">min</span>(hhsize_all<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>yr_max <span class="ot">&lt;-</span> <span class="fu">max</span>(hhsize_all<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Light background: sample ~120 other CBSAs</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>bg_ids <span class="ot">&lt;-</span> hhsize_all <span class="sc">%&gt;%</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(NAME <span class="sc">%in%</span> highlight_full)) <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GEOID)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">&lt;-</span> hhsize_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> bg_ids)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Highlights with a simple 2-level variable to guarantee color mapping</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">&lt;-</span> hhsize_all <span class="sc">%&gt;%</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> highlight_full) <span class="sc">%&gt;%</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">ifelse</span>(<span class="fu">startsWith</span>(NAME, <span class="st">"New York"</span>), <span class="st">"NYC"</span>, <span class="st">"LA"</span>))</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>lab_df <span class="ot">&lt;-</span> hi <span class="sc">%&gt;%</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(highlight) <span class="sc">%&gt;%</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> year, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Plot</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bg, <span class="fu">aes</span>(year, hh_size, <span class="at">group =</span> NAME_short)) <span class="sc">+</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#999999"</span>, <span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">linewidth =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale_color</span>() <span class="sc">+</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> hi, <span class="fu">aes</span>(<span class="at">color =</span> highlight), <span class="at">linewidth =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> hi, <span class="fu">aes</span>(<span class="at">color =</span> highlight),</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> lab_df,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hh_size, <span class="at">label =</span> highlight, <span class="at">color =</span> highlight),</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="fl">0.25</span>, <span class="at">size =</span> <span class="fl">3.7</span>, <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.12</span>, <span class="st">"lines"</span>),</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">segment.alpha =</span> <span class="fl">0.5</span>, <span class="at">segment.size =</span> <span class="fl">0.25</span>,</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">seed =</span> <span class="dv">7</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="at">NYC =</span> <span class="st">"#0072B2"</span>, <span class="at">LA =</span> <span class="st">"#D55E00"</span>)  <span class="co"># blue / orange</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(yr_min, yr_max, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Household Size Over Time — NYC &amp; LA Highlighted"</span>,</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Lightly sampled background (other CBSAs) with bold highlights and smoothers"</span>,</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Average Household Size"</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/v-household-size-highlight-clean-1.png" class="img-fluid figure-img" width="1980"></p>
<figcaption>Average household size over time — NYC &amp; LA highlighted, with lightly sampled background</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="task-4-rent-burden-index-rbi" class="level2">
<h2 class="anchored" data-anchor-id="task-4-rent-burden-index-rbi">Task 4: Rent Burden Index (RBI)</h2>
<p>The <strong>Rent Burden Index (RBI)</strong> measures the share of income that households spend on rent.<br>
It is calculated as:<br>
[ RBI = ]</p>
<p>To make comparisons easier, we rescale it between <strong>0–100</strong> each year:<br>
- <strong>0 = Least burdened</strong><br>
- <strong>100 = Most burdened</strong></p>
<p>We’ll examine how rent burden evolved nationally and in major metros such as New York City.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Merge INCOME and RENT for all years (CBSA level)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_to_income =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income)   <span class="co"># annual rent share of income</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Standardize rent burden - 0 = lowest, 100 = highest</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(rent_to_income, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)))</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Summary for interpretation</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_burden =</span> <span class="fu">mean</span>(rent_burden_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_burden =</span> <span class="fu">median</span>(rent_burden_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(summary_tbl,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Average and Median Rent Burden Index by Year"</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-0b7f9928c04137976118" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0b7f9928c04137976118">{"x":{"filter":"none","vertical":false,"caption":"<caption>Average and Median Rent Burden Index by Year<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14"],[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2021,2022,2023],[27.39811559816648,29.26289417458911,29.88762525371978,29.54231105416104,29.669046810002,30.33980838437705,29.42334412011243,28.11692925005865,27.23467505903688,27.93418944746583,25.64043474668486,26.58648863574086,27.22513712505721,29.32242352002864],[25.51667639026764,27.29714892764624,28.07365781654311,27.61714462205129,27.57333245709908,28.43097603692233,28.17714502507604,26.18626065956152,25.52928048592483,26.37219364911935,23.96611993069786,24.78094477662762,25.41324793418024,28.02548027391956]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>avg_burden<\/th>\n      <th>median_burden<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"avg_burden","targets":2},{"name":"median_burden","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="rent-burden-spotlight-new-york-city-metro" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden-spotlight-new-york-city-metro">Rent Burden Spotlight: New York City Metro</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>metro_name <span class="ot">&lt;-</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>metro_burden <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> metro_name)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metro_burden, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#0072B2"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Rent Burden Over Time -"</span>, metro_name),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0 = Least, 100 = Most Burdened)"</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/rent-burden-nyc-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rent-burden-extremes-most-vs.-least-burdened-cbsas-latest-year" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden-extremes-most-vs.-least-burdened-cbsas-latest-year">Rent Burden Extremes: Most vs.&nbsp;Least Burdened CBSAs (Latest Year)</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(rent_income<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>rent_extremes <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index)) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>())</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>top10_highest <span class="ot">&lt;-</span> rent_extremes <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>top10_lowest  <span class="ot">&lt;-</span> rent_extremes <span class="sc">|&gt;</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top10_highest,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 10 Most Rent-Burdened CBSAs ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5b6a3cbd0da17bc15e1f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5b6a3cbd0da17bc15e1f">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 10 Most Rent-Burdened CBSAs (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10"],[17340,10380,15980,33100,38940,38660,45300,28580,35840,36100],["Clearlake, CA Micro Area","Aguadilla, PR Metro Area","Cape Coral-Fort Myers, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Port St. Lucie, FL Metro Area","Ponce, PR Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Key West-Key Largo, FL Micro Area","North Port-Bradenton-Sarasota, FL Metro Area","Ocala, FL Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[59444,21290,71547,76271,68316,20978,72743,88870,78914,58606],[1544,548,1797,1914,1679,502,1729,2091,1854,1365],[0.3116883116883117,0.3088774072334429,0.3013962849595371,0.3011367361120216,0.2949235903741437,0.287157975021451,0.2852233204569512,0.2823449983121413,0.2819271612134729,0.2794935672115483],[72.85616460236997,71.77009832808356,68.8795715506868,68.77928808166736,66.37867712121739,63.37822902023986,62.63072475297169,61.51860989520941,61.35716763052359,60.41688509398345],[1,2,3,4,5,6,7,8,9,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>GEOID<\/th>\n      <th>NAME<\/th>\n      <th>year<\/th>\n      <th>household_income<\/th>\n      <th>monthly_rent<\/th>\n      <th>rent_to_income<\/th>\n      <th>rent_burden_index<\/th>\n      <th>rank<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"GEOID","targets":1},{"name":"NAME","targets":2},{"name":"year","targets":3},{"name":"household_income","targets":4},{"name":"monthly_rent","targets":5},{"name":"rent_to_income","targets":6},{"name":"rent_burden_index","targets":7},{"name":"rank","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top10_lowest,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 10 Least Rent-Burdened CBSAs ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9a89b81b75248970f004" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9a89b81b75248970f004">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 10 Least Rent-Burdened CBSAs (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10"],[10700,34340,45180,19460,27620,49220,48020,13900,31820,29060],["Albertville, AL Micro Area","Mount Airy, NC Micro Area","Talladega-Sylacauga, AL Micro Area","Decatur, AL Metro Area","Jefferson City, MO Metro Area","Wisconsin Rapids-Marshfield, WI Micro Area","Watertown-Fort Atkinson, WI Micro Area","Bismarck, ND Metro Area","Manitowoc, WI Micro Area","Laconia, NH Micro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[60298,58291,61514,72956,68629,66461,82864,83440,68297,97692],[724,697,728,854,792,766,953,951,752,1037],[0.1440843809081561,0.1434869876996449,0.1420164515394869,0.1404682274247492,0.1384837313672063,0.1383066760957554,0.1380092681984939,0.1367689357622243,0.1321287904300335,0.1273799287556811],[8.098013060481414,7.867194608033472,7.299014595404498,6.700817814599241,5.934055986100067,5.865646062499009,5.750734761845348,5.271499964090987,3.478658750882534,1.643812142406744],[521,522,523,524,525,526,527,528,529,530]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>GEOID<\/th>\n      <th>NAME<\/th>\n      <th>year<\/th>\n      <th>household_income<\/th>\n      <th>monthly_rent<\/th>\n      <th>rent_to_income<\/th>\n      <th>rent_burden_index<\/th>\n      <th>rank<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"GEOID","targets":1},{"name":"NAME","targets":2},{"name":"year","targets":3},{"name":"household_income","targets":4},{"name":"monthly_rent","targets":5},{"name":"rent_to_income","targets":6},{"name":"rent_burden_index","targets":7},{"name":"rank","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="task-5-housing-growth-metrics-hgi" class="level2">
<h2 class="anchored" data-anchor-id="task-5-housing-growth-metrics-hgi">Task 5: Housing Growth Metrics (HGI)</h2>
<p>To understand how new housing supply keeps up with population change,<br>
I construct three housing-growth indicators:</p>
<ol type="1">
<li><strong>Instantaneous Index (Inst Index)</strong> – permits per 1,000 residents each year.<br>
</li>
<li><strong>Rate-based Index (Rate Index)</strong> – permits per 1,000 new residents over the past 5 years.<br>
</li>
<li><strong>Composite Index (HGI)</strong> – an average of the two, capturing both immediate and trend-based growth.</li>
</ol>
<p>A higher score → a more “building-friendly” metro (YIMBY).<br>
Next, I’ll build each metric step by step.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join POPULATION with PERMITS, compute 5-year population growth</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure keys exist (you already created std_cbsa earlier)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>pop_core <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>permits_core <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(std_cbsa, year, new_housing_units_permitted)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> permits_core <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(pop_core, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_5yr_ago    =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_5yr_growth =</span> population <span class="sc">-</span> pop_5yr_ago,              <span class="co"># absolute growth over 5y</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_pos     =</span> <span class="fu">if_else</span>(pop_5yr_growth <span class="sc">&gt;</span> <span class="dv">0</span>, pop_5yr_growth, <span class="cn">NA_real_</span>), <span class="co"># avoid divide-by-≤0</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short     =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)                  <span class="co"># cleaner label for tables/plots</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="instantaneous-building-index---permits-per-1000-residents" class="level3">
<h3 class="anchored" data-anchor-id="instantaneous-building-index---permits-per-1000-residents">Instantaneous Building Index - Permits per 1,000 Residents</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Permits per 1,000 residents - standardized 0 (low) .. 100 (high), by year</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">permits_per_1k =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inst_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1k, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Top/bottom CBSAs (latest year) for instantaneous index</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(housing_panel<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>inst_latest <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_index)) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, NAME_short, year, permits_per_1k, inst_index)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(inst_latest, <span class="dv">15</span>),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 15 CBSAs - Instantaneous Building ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-224d0d9b7960e4e2b5d9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-224d0d9b7960e4e2b5d9">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 CBSAs - Instantaneous Building (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Salisbury, MD Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Punta Gorda, FL Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Sherman-Denison, TX Metro Area","Cape Coral-Fort Myers, FL Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Lakeland-Winter Haven, FL Metro Area","Burlington, NC Metro Area","Elizabethtown, KY Metro Area","St. George, UT Metro Area","Raleigh-Cary, NC Metro Area","Homosassa Springs, FL Metro Area"],["Salisbury","Myrtle Beach-Conway-North Myrtle Beach","Punta Gorda","Crestview-Fort Walton Beach-Destin","North Port-Bradenton-Sarasota","Daphne-Fairhope-Foley","Sherman-Denison","Cape Coral-Fort Myers","Austin-Round Rock-San Marcos","Lakeland-Winter Haven","Burlington","Elizabethtown","St. George","Raleigh-Cary","Homosassa Springs"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[37.73032148639273,33.14900447320355,21.48602365451599,18.35849588935037,17.50121963547183,17.21057012232404,16.65679647668253,16.24303685836949,15.67678482983089,15.29089731526401,15.237351045126,14.35051737594955,13.92922766878075,13.6619245165253,13.2096750971829],[100,87.83155288036811,56.8534815220872,48.54644751504609,46.26943399858236,45.49743912878755,44.02655961884863,42.92757170310595,41.42354833039034,40.3985915763358,40.25636719964409,37.90084616143272,36.78185755859859,36.07187301403047,34.87065224534994]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>permits_per_1k<\/th>\n      <th>inst_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"NAME_short","targets":2},{"name":"year","targets":3},{"name":"permits_per_1k","targets":4},{"name":"inst_index","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">tail</span>(inst_latest, <span class="dv">15</span>),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Bottom 15 CBSAs - Instantaneous Building ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7e1eec2ab3f9df50ba1a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7e1eec2ab3f9df50ba1a">{"x":{"filter":"none","vertical":false,"caption":"<caption>Bottom 15 CBSAs - Instantaneous Building (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Youngstown-Warren, OH Metro Area","Vineland, NJ Metro Area","Rockford, IL Metro Area","Peoria, IL Metro Area","Anniston-Oxford, AL Metro Area","Fairbanks-College, AK Metro Area","Williamsport, PA Metro Area","Bay City, MI Metro Area","Johnstown, PA Metro Area","Decatur, IL Metro Area","Enid, OK Metro Area","Weirton-Steubenville, WV-OH Metro Area","Morgantown, WV Metro Area","Danville, IL Micro Area","Wheeling, WV-OH Metro Area"],["Youngstown-Warren","Vineland","Rockford","Peoria","Anniston-Oxford","Fairbanks-College","Williamsport","Bay City","Johnstown","Decatur","Enid","Weirton-Steubenville","Morgantown","Danville","Wheeling"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[0.680800715545028,0.676181347898586,0.5985801678418791,0.5801281254402758,0.5496912281304486,0.5166596372838465,0.5056598417373408,0.3707317073170732,0.3596902072427832,0.3380024057818294,0.1612305112619512,0.1402204967311097,0.1198727938117433,0.1116507564338748,0.08117062803928658],[1.592678915287403,1.580409401789419,1.374292721100752,1.325282206969836,1.24443869093852,1.156703403173661,1.127486819809298,0.7691038779790699,0.7397765231183159,0.6821715015799833,0.2126472480717351,0.1568424980260115,0.1027969154419047,0.08095834221935833,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>permits_per_1k<\/th>\n      <th>inst_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"NAME_short","targets":2},{"name":"year","targets":3},{"name":"permits_per_1k","targets":4},{"name":"inst_index","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rate-based-building-index---permits-per-1000-new-residents" class="level3">
<h3 class="anchored" data-anchor-id="rate-based-building-index---permits-per-1000-new-residents">Rate-based Building Index - Permits per 1,000 New Residents</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Permits per 1,000 *new residents* over prior 5 years - standardized 0..100 by year</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: CBSAs with non-positive 5y growth are set to NA for this metric.</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_1k_newres =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> growth_pos</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1k_newres, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>rate_latest <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rate_index)) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, NAME_short, year, pop_5yr_growth, permits_per_1k_newres, rate_index)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(rate_latest, <span class="dv">15</span>),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 15 CBSAs - Rate-based Building vs 5-Year Growth ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1db363d34ad0c8903d0c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1db363d34ad0c8903d0c">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 CBSAs - Rate-based Building vs 5-Year Growth (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Springfield, OH Metro Area","Urban Honolulu, HI Metro Area","Dalton, GA Metro Area","Brunswick-St. Simons, GA Metro Area","Anchorage, AK Metro Area","Racine-Mount Pleasant, WI Metro Area","Bridgeport-Stamford-Danbury, CT Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Hickory-Lenoir-Morganton, NC Metro Area","Brownsville-Harlingen, TX Metro Area","Roanoke, VA Metro Area","Casper, WY Metro Area","Wichita, KS Metro Area","Redding, CA Metro Area","Fayetteville, NC Metro Area"],["Springfield","Urban Honolulu","Dalton","Brunswick-St. Simons","Anchorage","Racine-Mount Pleasant","Bridgeport-Stamford-Danbury","Miami-Fort Lauderdale-West Palm Beach","Hickory-Lenoir-Morganton","Brownsville-Harlingen","Roanoke","Casper","Wichita","Redding","Fayetteville"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[53,758,282,614,426,542,1637,24375,3496,2985,1098,394,6397,445,5674],[4056.603773584906,2441.952506596306,1758.86524822695,1280.130293159609,1072.769953051643,966.789667896679,932.8039095907147,874.6666666666666,680.4919908466819,653.9363484087103,565.5737704918033,553.2994923857868,552.2901360012506,467.4157303370786,454.0007049700388],[100,60.15931783574483,43.30449419205948,31.4919575931633,26.37544880106903,23.76044025844366,22.92185930758334,21.4873530060691,16.69619363818938,16.04094694085637,13.86064618243472,13.5577847393384,13.53287939430884,11.43864747619756,11.10763868637358]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>pop_5yr_growth<\/th>\n      <th>permits_per_1k_newres<\/th>\n      <th>rate_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"NAME_short","targets":2},{"name":"year","targets":3},{"name":"pop_5yr_growth","targets":4},{"name":"permits_per_1k_newres","targets":5},{"name":"rate_index","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">tail</span>(rate_latest, <span class="dv">15</span>),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Bottom 15 CBSAs - Rate-based Building vs 5-Year Growth ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-de7d7b3e303c730090a0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-de7d7b3e303c730090a0">{"x":{"filter":"none","vertical":false,"caption":"<caption>Bottom 15 CBSAs - Rate-based Building vs 5-Year Growth (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Texarkana, TX-AR Metro Area","Toledo, OH Metro Area","Topeka, KS Metro Area","Twin Falls, ID Metro Area","Utica-Rome, NY Metro Area","Victoria, TX Metro Area","Vineland, NJ Metro Area","Walla Walla, WA Metro Area","Waterloo-Cedar Falls, IA Metro Area","Weirton-Steubenville, WV-OH Metro Area","Wheeling, WV-OH Metro Area","Wichita Falls, TX Metro Area","Williamsport, PA Metro Area","Worcester, MA Metro Area","Youngstown-Warren, OH Metro Area"],["Texarkana","Toledo","Topeka","Twin Falls","Utica-Rome","Victoria","Vineland","Walla Walla","Waterloo-Cedar Falls","Weirton-Steubenville","Wheeling","Wichita Falls","Williamsport","Worcester","Youngstown-Warren"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[-5825,-3527,-827,null,-6533,-246,-212,-3263,-1730,-5558,-5737,-1283,-1117,-75609,-115957],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>pop_5yr_growth<\/th>\n      <th>permits_per_1k_newres<\/th>\n      <th>rate_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"NAME_short","targets":2},{"name":"year","targets":3},{"name":"pop_5yr_growth","targets":4},{"name":"permits_per_1k_newres","targets":5},{"name":"rate_index","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="composite-building-friendliness-index-inst-rate-blend" class="level3">
<h3 class="anchored" data-anchor-id="composite-building-friendliness-index-inst-rate-blend">Composite Building-Friendliness Index (Inst + Rate Blend)</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple 50/50 blend; tweak weights if you prefer</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite =</span> <span class="fl">0.5</span> <span class="sc">*</span> inst_index <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> rate_index)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>comp_latest <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(composite)) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, NAME_short, year, inst_index, rate_index, composite)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(comp_latest, <span class="dv">15</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 15 CBSAs - Composite Building-Friendliness ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1b019e877ecf02e40c0b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1b019e877ecf02e40c0b">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 CBSAs - Composite Building-Friendliness (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Springfield, OH Metro Area","Urban Honolulu, HI Metro Area","Punta Gorda, FL Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Dalton, GA Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Brunswick-St. Simons, GA Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Sherman-Denison, TX Metro Area","Cape Coral-Fort Myers, FL Metro Area","Burlington, NC Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Lakeland-Winter Haven, FL Metro Area","Raleigh-Cary, NC Metro Area","St. George, UT Metro Area"],["Springfield","Urban Honolulu","Punta Gorda","Crestview-Fort Walton Beach-Destin","Dalton","North Port-Bradenton-Sarasota","Brunswick-St. Simons","Daphne-Fairhope-Foley","Sherman-Denison","Cape Coral-Fort Myers","Burlington","Austin-Round Rock-San Marcos","Lakeland-Winter Haven","Raleigh-Cary","St. George"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[4.026747171741365,4.753480519050793,56.8534815220872,48.54644751504609,8.887557452354599,46.26943399858236,17.92456157425979,45.49743912878755,44.02655961884863,42.92757170310595,40.25636719964409,41.42354833039034,40.3985915763358,36.07187301403047,36.78185755859859],[100,60.15931783574483,4.439794524860872,4.030597965420196,43.30449419205948,3.633566532625499,31.4919575931633,2.538904782948484,3.734826246189416,3.413438061883443,3.921225008700408,2.581890321993385,2.247149818076694,2.826780878952801,1.796737036782203],[52.01337358587068,32.45639917739781,30.64663802347404,26.28852274023314,26.09602582220704,24.95150026560393,24.70825958371154,24.01817195586802,23.88069293251902,23.17050488249469,22.08879610417225,22.00271932619186,21.32287069720624,19.44932694649164,19.2892972976904]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>inst_index<\/th>\n      <th>rate_index<\/th>\n      <th>composite<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"NAME_short","targets":2},{"name":"year","targets":3},{"name":"inst_index","targets":4},{"name":"rate_index","targets":5},{"name":"composite","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">tail</span>(comp_latest, <span class="dv">15</span>),</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Bottom 15 CBSAs - Composite Building-Friendliness ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c09d32bb5ea42e37c5f6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c09d32bb5ea42e37c5f6">{"x":{"filter":"none","vertical":false,"caption":"<caption>Bottom 15 CBSAs - Composite Building-Friendliness (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Texarkana, TX-AR Metro Area","Toledo, OH Metro Area","Topeka, KS Metro Area","Twin Falls, ID Metro Area","Utica-Rome, NY Metro Area","Victoria, TX Metro Area","Vineland, NJ Metro Area","Walla Walla, WA Metro Area","Waterloo-Cedar Falls, IA Metro Area","Weirton-Steubenville, WV-OH Metro Area","Wheeling, WV-OH Metro Area","Wichita Falls, TX Metro Area","Williamsport, PA Metro Area","Worcester, MA Metro Area","Youngstown-Warren, OH Metro Area"],["Texarkana","Toledo","Topeka","Twin Falls","Utica-Rome","Victoria","Vineland","Walla Walla","Waterloo-Cedar Falls","Weirton-Steubenville","Wheeling","Wichita Falls","Williamsport","Worcester","Youngstown-Warren"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[4.266801009887396,5.710545048583806,3.820198281852162,9.850424427073481,2.1162730998223,2.175325027136034,1.580409401789419,11.64816549931224,7.381750622612627,0.1568424980260115,0,4.637931133025718,1.127486819809298,3.917777369068345,1.592678915287403],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>inst_index<\/th>\n      <th>rate_index<\/th>\n      <th>composite<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"NAME_short","targets":2},{"name":"year","targets":3},{"name":"inst_index","targets":4},{"name":"rate_index","targets":5},{"name":"composite","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rolling-5-year-average---smoothed-view-of-housing-growth" class="level3">
<h3 class="anchored" data-anchor-id="rolling-5-year-average---smoothed-view-of-housing-growth">Rolling 5-Year Average - Smoothed View of Housing Growth</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Smooth volatility with 5-year rolling averages</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(RcppRoll)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>housing_panel_smooth <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_5yr_avg =</span> RcppRoll<span class="sc">::</span><span class="fu">roll_mean</span>(new_housing_units_permitted, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_5yr_avg     =</span> RcppRoll<span class="sc">::</span><span class="fu">roll_mean</span>(population, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_1k_avg =</span> <span class="dv">1000</span> <span class="sc">*</span> permits_5yr_avg <span class="sc">/</span> pop_5yr_avg</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inst_rolling_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1k_avg, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  housing_panel_smooth <span class="sc">%&gt;%</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_rolling_index)) <span class="sc">%&gt;%</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(NAME, year, permits_per_1k_avg, inst_rolling_index) <span class="sc">%&gt;%</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">15</span>),</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 15 CBSAs - Smoothed 5-Year Rolling Housing Growth Index"</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8f09c6fec8e8980251b4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8f09c6fec8e8980251b4">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 CBSAs - Smoothed 5-Year Rolling Housing Growth Index<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Punta Gorda, FL Metro Area","St. George, UT Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Cape Coral-Fort Myers, FL Metro Area","Greeley, CO Metro Area","Lakeland-Winter Haven, FL Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Boise City, ID Metro Area","Hilton Head Island-Bluffton-Port Royal, SC Metro Area","Raleigh-Cary, NC Metro Area","Coeur d'Alene, ID Metro Area","Salisbury, MD Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[21.75795845828709,19.77605145947096,16.9527563910382,16.67328768623496,15.72509396744838,14.97850048962636,14.96074872002315,13.95065654851695,13.67390639339247,13.37022994003617,13.2830976272372,13.20258690552736,13.05406789566252,12.84178811963284,12.65635375717852],[100,90.79301767774601,77.67735291593098,76.37907634377922,71.97422646325754,68.50591389545112,68.42344775096346,63.73104756646445,62.44540006260368,61.03466598708631,60.6298913613766,60.25587744852543,59.56592988834169,58.57978061572457,57.71834216373103]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>year<\/th>\n      <th>permits_per_1k_avg<\/th>\n      <th>inst_rolling_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"year","targets":2},{"name":"permits_per_1k_avg","targets":3},{"name":"inst_rolling_index","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="task-6-yimby-lens---relating-rent-burden-to-housing-growth" class="level2">
<h2 class="anchored" data-anchor-id="task-6-yimby-lens---relating-rent-burden-to-housing-growth">Task 6: YIMBY Lens - Relating Rent Burden to Housing Growth</h2>
<p>To spot “YIMBY success” metros, I merge: - the <strong>Rent Burden Index (RBI)</strong> (Task 4) and<br>
- the <strong>Housing Growth Indices</strong> (Task 5),</p>
<p>then look for CBSAs that: 1) started with <strong>high rent burden</strong> early on,<br>
2) <strong>reduced</strong> rent burden over time,<br>
3) had <strong>population growth</strong>, and<br>
4) maintained <strong>above-average housing growth</strong>.</p>
<p>The chunks below build the merged panel and create two visuals (cross-section and trends) plus a shortlist table.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build rent_panel used in Task 6 (from Task 4 results)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure std_cbsa exists (in case the earlier key-standardization chunk was skipped)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"std_cbsa"</span> <span class="sc">%in%</span> <span class="fu">names</span>(INCOME)) {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  INCOME <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"std_cbsa"</span> <span class="sc">%in%</span> <span class="fu">names</span>(RENT)) {</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  RENT <span class="ot">&lt;-</span> RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"std_cbsa"</span> <span class="sc">%in%</span> <span class="fu">names</span>(POPULATION)) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  POPULATION <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>rent_panel <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, std_cbsa, household_income) <span class="sc">|&gt;</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_to_income =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># same scaling you used in Task 4: 0 = least burdened, 100 = most</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(rent_to_income, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="merge-panels-rbi-housing-growth" class="level3">
<h3 class="anchored" data-anchor-id="merge-panels-rbi-housing-growth">Merge Panels (RBI + Housing Growth)</h3>
<p>I combine rent burden, population, and the instantaneous/rate indices into a single table for plotting.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Rent Burden and Housing Growth panels for comparison</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>combined_metrics <span class="ot">&lt;-</span> rent_panel <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(std_cbsa, year, NAME, rent_burden_index, population) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(std_cbsa, year, inst_index, rate_index, composite),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>, <span class="st">"year"</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_growth =</span> <span class="fl">0.5</span> <span class="sc">*</span> (inst_index <span class="sc">+</span> rate_index),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One place to define a year that exists in *all* joined panels you use for “latest year” tables</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>safe_latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    intersect,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>(rent_panel<span class="sc">$</span>year),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>(housing_panel<span class="sc">$</span>year),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>(combined_metrics<span class="sc">$</span>year)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="cross-section-latest-year-housing-growth-vs.-rent-burden" class="level3">
<h3 class="anchored" data-anchor-id="cross-section-latest-year-housing-growth-vs.-rent-burden">Cross-Section (Latest Year): Housing Growth vs.&nbsp;Rent Burden</h3>
<p>Interpretation: bottom-right quadrant = <strong>high housing growth &amp; low rent burden</strong> → potential YIMBY wins.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> safe_latest_year</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  combined_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> latest_year),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> avg_housing_growth, <span class="at">y =</span> rent_burden_index)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Housing Growth vs. Rent Burden -"</span>, latest_year),</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Housing Growth Index (0–100)"</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Higher housing growth tends to correlate with lower rent burden"</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/vis-rb-vs-hg-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Figure 6A. Housing Growth Index vs.&nbsp;Rent Burden Index (0–100 scale) - latest year.</figcaption>
</figure>
</div>
</div>
</div>
<p>💡 Interpretation: Points in the bottom-right quadrant → places with high housing growth and low rent burden - potential “YIMBY” success stories.</p>
</section>
<section id="trends-over-time-rent-burden-for-selected-cbsas" class="level3">
<h3 class="anchored" data-anchor-id="trends-over-time-rent-burden-for-selected-cbsas">Trends Over Time: Rent Burden for Selected CBSAs</h3>
<p>I compare several major metros to see whether rent burden is <strong>falling</strong> while housing growth is strong.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select 4 CBSAs to visualize</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>top_cbsa_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Austin-Round Rock-Georgetown, TX Metro Area"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Atlanta-Sandy Springs-Alpharetta, GA Metro Area"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"San Francisco-Oakland-Berkeley, CA Metro Area"</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot colorful rent burden trend lines</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  combined_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME <span class="sc">%in%</span> top_cbsa_names),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">color =</span> NAME_short, <span class="at">group =</span> NAME_short)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.2</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Trends Across Major CBSAs"</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Tracking affordability over time (lower = more affordable)"</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mp02_files/figure-html/vis-trend-1.png" class="img-fluid figure-img" width="1600"></p>
<figcaption>Trends in Rent Burden (2010–2023) for Selected CBSAs</figcaption>
</figure>
</div>
</div>
</div>
<p>💡 Interpretation: The trends show how rent burden evolved in major metropolitan areas from 2010 to 2023:</p>
<p>Austin, TX demonstrates improving affordability, with declining rent burden — aligning with strong housing growth (a “YIMBY” success).</p>
<p>New York City and San Francisco continue to show higher rent burdens, reflecting housing shortages and slower new permit activity.</p>
<p>Atlanta maintains moderate rent burdens, indicating balanced housing supply and population growth.</p>
<p>Together, these trends highlight that sustained housing growth correlates with improved affordability — a key insight supporting the YIMBY (Yes In My Backyard) policy proposal.</p>
</section>
<section id="shortlist-potential-yimby-success-cbsas" class="level3">
<h3 class="anchored" data-anchor-id="shortlist-potential-yimby-success-cbsas">Shortlist: Potential YIMBY Success CBSAs</h3>
<p>Criteria: rent burden <strong>decreased</strong>, population <strong>increased</strong>, and average housing growth <strong>above 50</strong> (on 0–100 scale).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defensive check for available years</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(combined_metrics<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>earliest_year <span class="ot">&lt;-</span> <span class="fu">min</span>(combined_metrics<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>yimby_success <span class="ot">&lt;-</span> combined_metrics <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME_short) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> <span class="fu">first</span>(rent_burden_index) <span class="sc">-</span> <span class="fu">last</span>(rent_burden_index),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_growth =</span> <span class="fu">last</span>(population) <span class="sc">-</span> <span class="fu">first</span>(population),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_hg =</span> <span class="fu">mean</span>(avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ↓ Temporarily relax filters for debugging</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_burden_change), <span class="sc">!</span><span class="fu">is.na</span>(pop_growth)) <span class="sc">%&gt;%</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_hg))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  yimby_success,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Potential YIMBY Success CBSAs (check filters below)"</span>,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ee1bfbce5c3853d8cf75" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ee1bfbce5c3853d8cf75">{"x":{"filter":"none","vertical":false,"caption":"<caption>Potential YIMBY Success CBSAs (check filters below)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501"],["New Bern","The Villages","Glens Falls","Myrtle Beach-Conway-North Myrtle Beach","St. George","Austin-Round Rock","Bend-Redmond","Naples-Immokalee-Marco Island","Austin-Round Rock-Georgetown","Pittsburgh","North Port-Sarasota-Bradenton","Raleigh","Greeley","Norwich-New London","Coeur d'Alene","Nashville-Davidson--Murfreesboro--Franklin","Cape Coral-Fort Myers","Punta Gorda","Boise City","Provo-Orem","Sioux Falls","Hilton Head Island-Bluffton","Crestview-Fort Walton Beach-Destin","Daphne-Fairhope-Foley","North Port-Bradenton-Sarasota","Brunswick-St. Simons","Fargo","Fayetteville-Springdale-Rogers","Wilmington","Salisbury","Charleston-North Charleston","Raleigh-Cary","Orlando-Kissimmee-Sanford","Charlotte-Concord-Gastonia","Austin-Round Rock-San Marcos","Naples-Marco Island","Prescott","Buffalo-Cheektowaga-Niagara Falls","Houston-The Woodlands-Sugar Land","Lakeland-Winter Haven","Fort Collins","Des Moines-West Des Moines","Burlington","Reno","Durham-Chapel Hill","Ocean City","Dallas-Fort Worth-Arlington","Iowa City","College Station-Bryan","Lawrence","Hilton Head Island-Bluffton-Port Royal","Auburn-Opelika","Denver-Aurora-Lakewood","Greenville-Anderson-Mauldin","Bowling Green","Logan","Rapid City","Sebastian-Vero Beach","Bend","Colorado Springs","Salt Lake City","Panama City","Lubbock","Jacksonville","Clarksville","Huntsville","Dover","Missoula","Lincoln","Port St. Lucie","Valdosta","Ocala","Hinesville","Phoenix-Mesa-Scottsdale","Hammond","Urban Honolulu","Homosassa Springs","Idaho Falls","Lake Charles","Billings","Louisville/Jefferson County","Warner Robins","Madison","Sherman-Denison","Mankato-North Mankato","Jonesboro","Seattle-Tacoma-Bellevue","Greenville-Anderson","Wausau","Asheville","Atlanta-Sandy Springs-Roswell","Panama City-Panama City Beach","Greenville","Savannah","Bismarck","Gainesville","Spartanburg","Columbia","Laredo","Phoenix-Mesa-Chandler","Charlottesville","Champaign-Urbana","Racine-Mount Pleasant","Olympia-Tumwater","Wenatchee","Winchester","Great Falls","Tampa-St. Petersburg-Clearwater","Kennewick-Richland","Bellingham","Tallahassee","Las Vegas-Henderson-Paradise","Deltona-Daytona Beach-Ormond Beach","Portland-Vancouver-Hillsboro","Killeen-Temple","Ogden-Clearfield","Kansas City","Sebastian-Vero Beach-West Vero Corridor","Gulfport-Biloxi-Pascagoula","Cleveland","Ithaca","Boulder","Spokane-Spokane Valley","Pensacola-Ferry Pass-Brent","McAllen-Edinburg-Mission","Cheyenne","Ames","Athens-Clarke County","Mobile","Bridgeport-Stamford-Danbury","Richmond","Brunswick","Houston-Pasadena-The Woodlands","Chicago-Naperville-Elgin","Palm Bay-Melbourne-Titusville","Augusta-Richmond County","Corpus Christi","San Antonio-New Braunfels","Rochester","Omaha-Council Bluffs","Springfield","Midland","Flagstaff","Grand Junction","Brownsville-Harlingen","Lafayette-West Lafayette","Odessa","Alexandria","Lexington-Fayette","Lake Havasu City-Kingman","Winston-Salem","Portland-South Portland","Waco","Atlanta-Sandy Springs-Alpharetta","Eau Claire","Scranton--Wilkes-Barre--Hazleton","St. Joseph","Yuma","Grand Forks","Las Cruces","Hickory-Lenoir-Morganton","Provo-Orem-Lehi","Indianapolis-Carmel-Anderson","Bremerton-Silverdale-Port Orchard","Minneapolis-St. Paul-Bloomington","Knoxville","Chattanooga","Fond du Lac","Greenville-Anderson-Greer","Oklahoma City","Tuscaloosa","Gulfport-Biloxi","Grand Rapids-Wyoming","Hagerstown-Martinsburg","Salt Lake City-Murray","Lafayette","Denver-Aurora-Centennial","Bremerton-Silverdale","Burlington-South Burlington","Medford","Baton Rouge","Fort Collins-Loveland","San Jose-Sunnyvale-Santa Clara","Mount Vernon-Anacortes","Bangor","Washington-Arlington-Alexandria","Wichita","Sebring","Miami-Fort Lauderdale-West Palm Beach","Fort Wayne","St. Cloud","Tulsa","St. Louis","Memphis","Olympia-Lacey-Tumwater","San Luis Obispo-Paso Robles-Arroyo Grande","Carson City","Salem","Johnson City","Tucson","Joplin","Waterloo-Cedar Falls","Harrisonburg","Appleton","Virginia Beach-Norfolk-Newport News","Casper","Beaumont-Port Arthur","Birmingham-Hoover","Morristown","Albany-Schenectady-Troy","Houma-Thibodaux","El Paso","San Francisco-Oakland-Hayward","Chico","Little Rock-North Little Rock-Conway","Indianapolis-Carmel-Greenwood","Anchorage","Hartford-East Hartford-Middletown","Sacramento--Roseville--Arden-Arcade","Sebring-Avon Park","Kahului-Wailuku-Lahaina","Greensboro-High Point","Eugene","New York-Newark-Jersey City","San Luis Obispo-Paso Robles","Stockton","Oshkosh-Neenah","Pocatello","Bloomington","Corvallis","Green Bay","Elizabethtown-Fort Knox","Fayetteville","Blacksburg-Christiansburg-Radford","San Diego-Carlsbad","Cedar Rapids","Chambersburg","Stockton-Lodi","Sioux City","Las Vegas-Henderson-North Las Vegas","Visalia-Porterville","Columbus","La Crosse-Onalaska","Sacramento-Roseville-Folsom","Shreveport-Bossier City","Evansville","Mankato","Monroe","Albany-Lebanon","Goldsboro","Santa Rosa","Madera","Staunton","Cape Girardeau","California-Lexington Park","Dalton","Dubuque","Lynchburg","Miami-Fort Lauderdale-Pompano Beach","Harrisburg-Carlisle","Florence-Muscle Shoals","Hanford-Corcoran","Eugene-Springfield","Staunton-Stuarts Draft","Milwaukee-Waukesha-West Allis","Albuquerque","Baltimore-Columbia-Towson","Sheboygan","Omaha","Amarillo","Boston-Cambridge-Newton","Riverside-San Bernardino-Ontario","Wenatchee-East Wenatchee","State College","Lewiston-Auburn","Owensboro","Davenport-Moline-Rock Island","Dothan","New Orleans-Metairie","Akron","Fresno","Grand Rapids-Kentwood","Visalia","Cincinnati","Gadsden","Manchester-Nashua","Jackson","Redding","Bakersfield","Vallejo-Fairfield","San Francisco-Oakland-Berkeley","Tyler","Yuba City","Santa Maria-Santa Barbara","Lebanon","San Angelo","Fort Smith","Philadelphia-Camden-Wilmington","Kingsport-Bristol","Duluth","Roanoke","Wausau-Weston","Abilene","Atlantic City-Hammonton","Kalamazoo-Portage","Grants Pass","Dayton","Vallejo","Sumter","Gettysburg","Florence","Yakima","Lancaster","Longview","Santa Fe","Cleveland-Elyria","Detroit-Warren-Dearborn","Janesville-Beloit","Rome","Trenton","Virginia Beach-Chesapeake-Norfolk","Wichita Falls","Pueblo","Oxnard-Thousand Oaks-Ventura","San Diego-Chula Vista-Carlsbad","York-Hanover","South Bend-Mishawaka","Topeka","Bridgeport-Stamford-Norwalk","Macon-Bibb County","Montgomery","Lansing-East Lansing","Lewiston","Merced","Elkhart-Goshen","Poughkeepsie-Newburgh-Middletown","Michigan City-La Porte","Bakersfield-Delano","Birmingham","Binghamton","Ann Arbor","Barnstable Town","Chambersburg-Waynesboro","Watertown-Fort Drum","Milwaukee-Waukesha","Syracuse","Muskegon","Allentown-Bethlehem-Easton","Jefferson City","Worcester","El Centro","Grand Rapids-Wyoming-Kentwood","Albany","Kingston","Victoria","Longview-Kelso","Santa Cruz-Watsonville","Kokomo","Rocky Mount","Racine","Salinas","Macon","Manhattan","Pittsfield","Napa","East Stroudsburg","Toledo","Muskegon-Norton Shores","Trenton-Princeton","Providence-Warwick","Decatur","New Haven-Milford","Texarkana","Hartford-West Hartford-East Hartford","Peoria","Modesto","Kingsport-Bristol-Bristol","Reading","Anniston-Oxford-Jacksonville","Terre Haute","Hattiesburg","Lawton","Utica-Rome","Hot Springs","Buffalo-Cheektowaga","Muncie","Mansfield","Lima","Wheeling","Carbondale-Marion","Norwich-New London-Willimantic","Cumberland","Scranton--Wilkes-Barre","Huntington-Ashland","Farmington","Charleston","Anniston-Oxford","Morgantown","Fairbanks","Enid","Altoona","Anderson","Atlanta-Sandy Springs-Marietta","Baltimore-Towson","Battle Creek","Bay City","Beckley","Blacksburg-Christiansburg","Bloomington-Normal","Bloomsburg-Berwick","Boise City-Nampa","Boston-Cambridge-Quincy","Bradenton-Sarasota-Venice","Buffalo-Niagara Falls","Canton-Massillon","Cape Girardeau-Jackson","Charleston-North Charleston-Summerville","Charlotte-Gastonia-Concord","Charlotte-Gastonia-Rock Hill","Chicago-Joliet-Naperville","Chicago-Naperville-Joliet","Cincinnati-Middletown","Cleveland-Elyria-Mentor","Danville","Dayton-Kettering","Dayton-Kettering-Beavercreek","Denver-Aurora-Broomfield","Detroit-Warren-Livonia","Elizabethtown","Elmira","Erie","Fairbanks-College","Flint","Fort Walton Beach-Crestview-Destin","Grand Island","Greenville-Mauldin-Easley","Hilton Head Island-Bluffton-Beaufort","Hinesville-Fort Stewart","Holland-Grand Haven","Honolulu","Houma-Bayou Cane-Thibodaux","Houston-Sugar Land-Baytown","Indianapolis-Carmel","Janesville","Johnstown","Kahului-Wailuku","Kankakee","Kankakee-Bradley","Kennewick-Pasco-Richland","Killeen-Temple-Fort Hood","La Crosse","Las Vegas-Paradise","Los Angeles-Long Beach-Anaheim","Los Angeles-Long Beach-Santa Ana","Louisville-Jefferson County","Madera-Chowchilla","Myrtle Beach-North Myrtle Beach-Conway","New Haven","New Orleans-Metairie-Kenner","New York-Northern New Jersey-Long Island","Niles","Niles-Benton Harbor","Ogden","Olympia","Orlando-Kissimmee","Palm Coast","Panama City-Lynn Haven-Panama City Beach","Parkersburg-Marietta-Vienna","Parkersburg-Vienna","Pascagoula","Phoenix-Mesa-Glendale","Pine Bluff","Portland-South Portland-Biddeford","Portland-Vancouver-Beaverton","Prescott Valley-Prescott","Providence-New Bedford-Fall River","Reno-Sparks","Rockford","Sacramento--Arden-Arcade--Roseville","Saginaw","Saginaw-Saginaw Township North","San Antonio","San Diego-Carlsbad-San Marcos","San Francisco-Oakland-Fremont","Sandusky","Santa Barbara-Santa Maria-Goleta","Santa Rosa-Petaluma","Sierra Vista-Douglas","Spokane","Staunton-Waynesboro","Steubenville-Weirton","Trenton-Ewing","Twin Falls","Vineland","Vineland-Bridgeton","Vineland-Millville-Bridgeton","Walla Walla","Weirton-Steubenville","Williamsport","Youngstown-Warren","Youngstown-Warren-Boardman"],[4.855079904383047,-23.1768575284777,7.994809672687509,1.34471864006823,-10.46364201562503,-3.80832408908287,7.808436055011924,1.207056103278177,-2.364661733731321,-2.413954049255025,-6.64409148089883,-1.358497714811175,-13.96713742882341,7.162098747710022,-11.21978742202797,-14.55576700491675,-21.37686196976161,1.333819460234949,-10.1770870620799,-1.687329949186005,0.5942646233287778,-5.713251031037046,-7.63716435796659,0.2195338742161326,-15.44811219213898,0,0.08771054754002705,-5.913749587568979,1.947433926726703,8.396441573173476,-4.079230362915887,-11.62322743949776,-10.43363828616876,-10.3300425896337,-6.024120911794341,-18.07013052035977,8.721654826408745,-0.8901083117041431,-9.956663685524003,-6.728644096432426,-6.237157265416929,-5.865400601916054,1.879972993697777,-14.62759408670347,-14.02845584884472,9.240633343593199,-15.51422131463671,-2.000919743826724,8.666198716854886,14.26798693177638,0,9.985220023636991,-8.203293407543619,2.272656745140566,-2.565819361384442,-1.341462188338369,-3.327996780886963,7.704619133908253,-10.3876632772742,-21.53845068744514,-4.44667587365403,0.2446518374132509,-10.9932196785614,-2.77395763130334,-8.209030207607455,-10.23802506441176,-3.61220450808927,5.838774089939673,-2.775205818996017,-11.15426886408832,0.4652758943721551,-13.08572620621924,12.14850854703578,-0.2940280832199633,1.024928417395991,8.122964614160708,0.7993049749428138,-7.000559881137441,-3.750665896629865,1.017069039066531,-3.222681588888815,-2.094072222273844,-8.483910917613201,-14.30875713371725,-2.530805632729813,1.426184572175629,-8.768505760217646,-4.41783174682179,-2.387962592030496,-5.160924874509391,-12.38818266492366,0,3.464262214754591,-1.88424029591809,-5.271499964090987,26.17227212578155,-3.677304946200351,-6.550532405705603,10.81776521768577,-14.09225144275369,2.193159167834253,11.96687312358309,0,2.103795899842428,2.428965229813379,12.98024103847835,-7.634452399229142,-14.65516612949475,-6.488679747011432,-14.69819903936964,7.03923439021009,-8.349512142325544,-11.58926423066196,-5.834519748701037,-9.578600461091064,-6.904536962118129,-7.121987779087231,0,1.670068929209748,2.845207904165797,-6.353130694209412,-18.8416709283081,-6.349748801861896,4.289624197299879,8.324904648835798,-5.030235874453606,6.305966148974747,0.4582445301811973,-2.710777400616422,0,-6.851413159704958,-3.388049808484318,0,-0.6004019256473327,-7.049338464698415,-1.761341706384275,-7.862204382860554,-12.26444871219412,-15.50304989223131,0.4976457583177094,-2.702211512805274,3.197964553040428,-17.21111603594649,-15.291101227525,8.502585502992794,-2.689227084296235,-4.933537840415287,-2.627081005659413,-5.701470903943708,-0.6937570650346672,-5.845420572639554,-1.702575582718797,2.009385993042535,-5.512894866705238,3.903136604662887,1.502571807440027,2.797373638104528,15.35393323185613,8.490256041815998,1.127217057038578,7.855885496029821,0,4.833424171660177,-0.7134851252340084,-7.862098768604795,-8.433218158933045,-6.881103596271064,-2.86966763591883,0,-4.803732371076592,1.416049205942123,11.51422221058779,3.093844860408691,1.038112536953331,0,3.811067961013965,0,-2.251837162985534,-1.661756512761407,-10.34297303477543,-7.64130884163346,-16.96411617181006,-6.320452263365318,-11.01418730080434,0.4915685128335845,-3.306494539142168,-5.654438465925486,-14.43914166901128,-5.737825793279974,-5.209117967784639,-0.5952635004902049,-7.493917887472449,0.3399701030968352,-5.610538634078821,-14.2670709774136,2.717375768665185,-11.17907328014042,-11.04617174179691,3.660671937490925,-5.698213892102029,4.504125749876543,-8.078874061901521,16.44435643196588,-4.220582896023908,-2.249657662835155,-10.23481614206123,-11.51789425771351,3.722501778834857,2.054057148757675,-5.783330130389029,-6.077682575964964,-8.468138712168553,0.02405557337558406,-15.06696143890054,-1.575593576030236,0,-2.604417848266003,-1.568173458805926,1.745812341571096,-8.170269174060977,4.299084187798918,-4.762139481793675,5.046936951757878,1.288361663655124,-6.226018330656622,1.019785642063475,0.2717728374449884,-17.0660870978951,1.075349997713779,-8.059407986272941,-2.412212536733382,2.3464066292265,-4.349648764945385,-3.939539030072893,-0.5018184542963837,-4.806630318854912,0,1.919074857609907,-2.092691257561398,0,6.31895889679609,9.474881347400324,-0.09437599312254363,-3.838227345222805,-10.33117906732381,-4.007250239816047,-4.587792852087052,6.056260422308487,-0.4952283962198614,-4.904366445417146,3.350434603343835,41.21713095420478,8.805816503739464,11.36604898026172,3.933101373584666,9.014791951480881,0.2282750407864409,-1.047129833230962,-3.481198693217685,-6.529215302892204,11.9082157732743,3.607269128256483,-0.4427542377693001,0,0.6809104410781046,-10.57340500114347,0.1082619885991143,-0.3600848029303254,0,-2.799546009389566,-7.010404741268765,-4.252693169114274,-7.540602458907713,-7.55863944309489,1.295632018520216,0.2076655269014047,-5.114784990262238,-1.552591687798646,3.464805597616667,2.564112307633767,-8.137494668260736,-2.832062353485526,0.4921961519395737,-2.255014310765736,3.482137968312152,-4.456689132350686,-14.23050715365235,9.089424232474961,-2.438747168120436,-5.629204481187351,-0.06125686817846088,-10.53094491628913,-1.317522792568937,0.2547176735740209,-12.18012935108136,-11.13258677536558,1.423996492932385,-7.315047839184988,-6.773086913594204,1.167936802958852,-4.840623489264651,-6.234734817383531,-15.51394338042428,7.005903395768073,-0.1103696642084522,18.8697696111191,3.078636180018712,-3.246987033112831,1.503174255074111,1.352007064544974,-17.92767393796219,0.2360730646049873,-12.08358141578198,-8.142292200805414,1.132423851804987,-0.03159356871167063,-1.457411791189447,8.633591879432839,7.622311492285998,-0.9661808392369551,0,2.07978460956749,-3.866499726740528,-7.186993134772365,-5.628884550137315,-4.90582260687647,-2.84908741975574,-4.488923207190528,-5.575697552305403,6.875689650462967,6.915676021053617,-0.2966274779207474,-8.71303366573116,-9.455693626323914,-0.4376134224959962,-8.863047481303447,-10.33974956780422,-2.931132119258436,0,-1.869537566289729,-8.913518176575113,1.282321015408726,17.90426000793614,-6.174257409335375,-3.195525894965183,-2.686843342338481,-6.106221846664393,-6.75418607123709,-3.10992135465025,-9.195465759038894,0.6327783373147078,0,-9.432884011772337,3.571199456479114,-10.75973151127986,0,4.86779280283335,-9.605427475066145,17.89225639944997,0.3262074817310143,-17.33228282392062,-6.208583329200984,8.857109067859206,14.57364133338335,-15.75735857035048,-0.5483448735058545,-2.218921544841855,2.4977741908856,1.283766844276116,0.5294704654528068,1.520620473958786,3.164566443688958,-15.36907768900053,-5.554459178259119,0.8956162648069732,0.1992522243762735,5.742841166394452,-6.983206234515457,0.241733946952678,-8.861429848083041,-9.606791686112263,-15.49806798844546,-7.184435677028576,1.304108975391273,-6.079439271776124,5.844210974495383,2.814768639601986,4.711672613545709,-2.040326544317258,12.21708455010799,0,-2.324874094336725,-15.23041177524062,9.976972872224273,-13.34241637394326,-5.872941459767176,-0.1913106735970374,11.0052468563992,-11.98736288013599,3.244966126885874,-7.599568052608372,-0.5379130457540739,-2.609581636096159,-1.087666357709427,3.300513954076106,-5.53534607054582,1.96964597532288,-2.818349507286872,-1.117902939221661,6.481730692678662,0.2713150468125178,-0.004040032660917348,0,3.276008794669242,0.7048570682391997,-8.91307892325249,-5.13191382356306,0,-1.367234654919873,0.5075291170427754,0,-2.561122353309665,-0.1268880995010981,-11.64133603535214,-1.106585899660168,0,-3.673374645145365,-0.1257488742106219,5.51030122312379,-9.64905542009426,-5.410463073945799,0,2.828639266721872,0,-1.418485445787624,-3.609731632188041,1.216668339434392,-18.87336751819802,6.426731668512836,-2.257544039393096,-19.27056487026778,0.2178223305566327,-0.1969368460687306,-0.3880834456135389,-1.25275787025249,0,0.5336714794797643,1.154715194939023,0.1481135697131482,6.52085204371485,-7.02704868911133,-1.544897618555865,-0.1905989708209574,-4.990848273910736,0,-10.6129794418697,-3.31577472872042,0,-2.239044991731816,-4.667622209519969,2.165826144897913,5.667694845113457,0,-4.603430955490595,0,-3.000439269304444,3.060117045644191,5.357753917660053,6.441988812224979,-1.761773998018185,-3.243689932968785,-6.892105086508359,-1.933474495650511,0,-12.83957094569106,-0.2873362266120623,-3.01483348441856,-0.3821449491481097,-2.736746661125295,3.027877532561689,-1.35416118386544,0,-2.074107250981022,-5.133524486591391,1.213602550269528,0.6072623152134824,-6.942017887130234,-8.59095075550578,3.109704498991242,-3.758068473430967,1.569140217244968,-6.625735849574248,-15.6203962633474,0,11.51275613511783,-11.98587731459456,2.379051267242943,-3.066961239936367,4.410590686429565,0,2.913264147468544],[-2475,30620,-3347,-7473,64979,463241,26042,38846,194032,67768,158876,148024,104683,3072,45620,522327,247665,49182,177200,159489,65000,6215,124090,53396,206799,0,62631,129526,112812,9529,137197,383404,677138,469757,744968,85773,16307,-3963,1026960,234927,50790,174171,28807,125480,107651,-458,1652809,27825,67338,4170,0,66793,288395,55661,70272,31255,31920,32185,102290,141341,135898,-6388,82551,-1114136,68144,120938,32048,17121,45837,130605,16300,81412,7198,493868,11015,-2380,27319,40758,47570,37581,77471,65064,124320,26877,8413,16251,636989,38481,7000,4531,781146,0,-4596,81843,29303,-42320,96505,690408,27710,121907,26715,12859,0,24031,10680,24667,2722,595691,43129,31485,33011,295117,225906,277429,78081,172277,153133,0,14745,16419,1779,23349,65103,74988,157319,12130,37942,27648,-81,0,114665,7103,0,-274481,107622,88534,29946,546102,866469,127384,-73165,50116,14623,13588,30339,15315,29869,-5930,49196,28857,210709,46429,71992,204164,14855,-6552,-4979,16249,6542,18791,4666,0,188580,6185,442206,247770,56132,3878,0,250648,61267,178136,291396,40690,0,219296,0,28943,20031,19482,86714,72389,105884,11883,5893,828208,39371,9378,355008,41873,13429,114041,-30265,30644,8467,7567,2860,40443,15180,42962,30487,1651,17379,24539,132310,5433,17002,-14213,-13558,47090,-9234,120767,213208,-13405,78370,0,26761,16426,129440,-603,1257,75077,23399,-451253,14668,118369,8365,-943,-24524,15108,27099,6114,31981,19275,132112,19344,0,96586,982,0,36193,1892136,34726,56878,-8221,-80872,2321,-19041,718,4875,4917,7867,3656,2484,4495,10403,5815,21667,592289,69136,10937,3918,30072,0,16446,67302,63578,3192,0,27388,234880,544940,14858,11583,7226,-492,-719,10656,-278812,-1537,264753,16828,13273,138801,-404,21448,21998,-733,108701,39376,-152204,40544,18131,589,13746,9646,-61773,277908,4783,3966,14265,3049,19958,98111,-64419,4222,-28515,1575,-330,5034,-1023,17589,50823,86624,8424,-1593,47321,3539,3863,-603,0,952,12198,26607,-68357,35703,6952,100,62003,6022,17988,19574,5373,46599,5907,26392,643,71613,0,-902,17973,10584,4010,-4316,-14755,6872,5557,57543,3903,63165,12183,0,-32742,893,-15011,0,5329,-13302,-1213,-4755,20353,508,9745,-2470,-1434,-261,-72079,2613,14241,73512,-50808,22157,8877,-44455,-13790,41045,3675,25696,-2459,-2066,11904,13459,-6241,1305,27621,-2871,574,-3519,-9120,5878,0,-5596,19139,81568,-3456,-101039,2348,21490,-3304,-580,-5849,57938,-34551,62263,-2250,-4934,-11945,1425,4582,-20324,34991,52122,0,10406,-8423,2219,38248,0,66771,48235,0,-24268,-27751,-8415,4984,0,90735,-111377,16040,-7006,-12720,0,-22521,0,-7988,13881,14664,8075,7142,68798,-4301,339075,54106,263,-13330,0,-6180,-175,22594,40902,2375,97925,-463120,178124,0,3586,18417,0,15393,90228,-1140,-6331,0,7353,0,6737,7136,4099,-4891,7625,118321,-30291,1291,0,13982,732,15061,-19598,69127,-8760,-1697,0,123270,249108,-915,24192,9710,-2808,7051,3241,-2050,2081,10276,0,-5976,40,-2138,-6823,-4116,0,-27464],[59.60125834791538,51.29493227546649,49.11819407947004,41.66387318574931,36.69473753638047,34.78511535811667,33.25209331676837,32.92164427918386,31.63334297852889,31.2007194434618,31.12898835525165,30.70465648639442,29.49510926174862,29.4172634692171,27.48272338586839,26.77014820080162,26.76823415366416,26.671682250704,26.63858781755637,26.56001681077311,26.29631861946389,26.0466229499901,25.85392033494625,25.70848528781003,24.95150026560393,24.70825958371154,24.22245189218621,23.46942316462595,22.75001561909199,22.65280751288361,22.50492296353255,22.39233341505266,22.37971995515809,22.01416520972569,22.00271932619186,21.98610559558984,21.84982537394781,21.41618610584737,21.15293060121864,21.12883113768401,21.08981296094635,21.05171440166297,20.93632389121769,20.80633695160568,20.53821568368033,20.3768290838734,19.95768676783874,19.78756192729787,19.58043946041762,18.85172583209374,18.83289148805942,18.80042115937564,18.78426803912173,18.71292710996062,18.69810224430672,18.51515568854511,18.51258103250924,18.48687723240155,18.30498687791206,18.14961120701248,18.14937216628162,18.14766823182378,17.8660728984832,17.85300496944864,17.81266507434524,17.73366801220126,17.70268545823644,17.62058893027157,17.60368266830303,17.53982024730529,17.43533023486585,17.25693749730105,17.09286936005811,17.04749370228998,17.03836094149135,17.01958426265158,16.97119648938753,16.88724697480901,16.79056188368891,16.72556142405124,16.55123283024951,16.49392242043447,16.46725099405414,16.33366550189764,16.30780407849561,16.29241574913184,16.21426938097442,16.20638691274896,16.17871273448947,16.15770055909987,16.13741371003237,16.1236523577623,16.07322477206376,16.00603748826652,15.79400346994319,15.77902024884619,15.75232496795784,15.74155415436682,15.71633189694341,15.61355930952597,15.43648178960632,15.34006342202065,15.3118558475615,15.30900036792983,15.26222540247719,15.21885585069019,15.20687405239248,15.1355699156315,14.89593845735102,14.77298701736629,14.75450816822627,14.70556878640279,14.6424606895529,14.59284532386401,14.51690278185882,14.50772463359738,14.31860397693844,14.12292583229926,14.10104323465408,14.05299847865643,14.01793113703922,13.95131999782442,13.94409953545753,13.86312242647966,13.84724722396274,13.79492317488923,13.74170239878272,13.64464669620783,13.62559257111825,13.48430334239703,13.45108211927333,13.43297262083568,13.37593015849125,13.33930314176827,13.28648986927736,13.28534820812158,13.02701201693306,13.02023709557793,12.94466721366216,12.8672509943596,12.80901802979198,12.78411594586007,12.71684926454078,12.56453013434633,12.47055015564608,12.43767585122266,12.43318278483419,12.38707814899324,12.37536537131753,12.36270127156977,12.18824584323564,12.17251782684719,11.99575722545904,11.9931727298141,11.92335917452397,11.90844222900112,11.9032550439384,11.86916611137475,11.81256059525844,11.75985048399119,11.7530533828015,11.70032678929651,11.68589203364127,11.66977228068233,11.60190140158827,11.56125497866567,11.53967737258974,11.50091215004527,11.4977504815749,11.43156879772804,11.33791520418891,11.33628846785497,11.28886846828512,11.28272443408652,11.27766283756833,11.23588092396408,11.14997394887756,11.02264630057715,10.90047248049591,10.88750430491478,10.83691751238607,10.7025075460795,10.69767844524294,10.68138570776156,10.6578749071706,10.63099292080795,10.60857991139316,10.48832381119204,10.43586857144851,10.41574897617347,10.29063458675942,10.20645232464838,10.19284476339475,10.11246540346136,10.07141461518481,10.03260802998343,9.905301791999809,9.841064392957792,9.74359038328763,9.723654100199603,9.721331935944495,9.647457870523811,9.569300936918895,9.529604824729185,9.375926532455329,9.374505492037928,9.298024106188208,9.277562109664458,9.23975218059457,9.211450739960593,9.198011984038056,9.194188997284577,9.155078879727732,9.141149121058277,9.138455055968178,9.011994389253807,9.009471659616453,8.978573801622767,8.959351910832819,8.955206345542502,8.94703174222194,8.919585985829674,8.879507712805196,8.868659570288944,8.850793275733654,8.823028714004211,8.815119645847478,8.779543964534891,8.725014099110465,8.704131504267759,8.665466831095303,8.643504533266304,8.62327653988949,8.62112524967325,8.597815310647837,8.567192453100089,8.557157853858506,8.546504114684879,8.524580993735778,8.492578062672436,8.487164436281473,8.409372433069894,8.331845885009526,8.257419880162931,8.207236452256927,8.196972139094663,8.15846527113958,8.086011993631997,8.044393484955886,8.020913178385436,7.987121893177323,7.959642406590844,7.909858559465261,7.886127140910348,7.812797194821867,7.797308369091415,7.774967063320165,7.774209809905738,7.754989075880106,7.668393607266283,7.643120345470678,7.627655190324947,7.58009190480997,7.550808624406833,7.547533265724582,7.523544599659776,7.458439822380636,7.425496644756943,7.366310239685545,7.348610313280131,7.326521224777367,7.322181450951145,7.225506916041113,7.225073949399108,7.223357383058475,7.21013047663291,7.152017070227108,7.151262787643264,7.085570709418924,7.067826518882725,7.062166654531875,7.020794657546539,6.977710493142832,6.938523219438593,6.896833365537133,6.889981940655197,6.867326506013679,6.778081851445833,6.766060939590866,6.696986961536051,6.621335751785792,6.506956433729413,6.489803652367248,6.470926737698566,6.43675276097827,6.403136894354313,6.401121260034158,6.383311655206729,6.287832182602382,6.28266763695937,6.265426413172806,6.247337844397117,6.246642838383619,6.231208173719082,6.221426589014322,6.199783329975473,6.17325248180458,6.125287818744331,6.104372527457411,6.060550956072426,6.058602303892616,6.041319963059465,6.006425847236496,5.958201462357334,5.895551130370627,5.893487024832165,5.809604442342123,5.808484193068356,5.779353504573617,5.754947874784694,5.719052068485356,5.649336923770724,5.643260261718877,5.577318535287917,5.563369637711135,5.510561690792289,5.448041431454743,5.261245597811835,5.177656521570865,5.125112277145909,5.066721836956484,5.060176203145264,4.964955265868535,4.952916694356907,4.911452870906979,4.897761348831503,4.871826174826246,4.867664087680227,4.862241430423987,4.840047762478441,4.827058937792979,4.778146228733376,4.7165786843695,4.633694059915216,4.628106150123253,4.613424696546556,4.595008445845975,4.574872597051271,4.567694561067944,4.465610781446541,4.433562359588317,4.387499038170968,4.373656000528432,4.176438846246005,4.171388508701535,4.107292090185307,4.068913210780539,4.049040412928798,3.974378536159399,3.905003810739055,3.878706526029986,3.842887141149344,3.705096092451448,3.693732706995499,3.67554900752502,3.602865580411364,3.586167339000709,3.532381151125255,3.48937948948471,3.407281712883526,3.34751144015376,3.326398719862468,3.266683183476967,3.256575779201969,3.010626361699568,3.004803183612564,2.955809110980775,2.868695632025144,2.721995395107964,2.512132501447992,2.468595529915012,2.429234932487488,2.407076167231894,2.367097881133797,2.332304923593962,2.273798919902579,2.254856220827082,2.151362153538762,2.011192668914091,1.964984005289573,1.926290815696874,1.909054554511332,1.907739857169791,1.888045641141467,1.884339426948409,1.67449735014788,1.475411978005628,1.415760719692601,0.6551427973840993,0.338150150325231,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME_short<\/th>\n      <th>rent_burden_change<\/th>\n      <th>pop_growth<\/th>\n      <th>avg_hg<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME_short","targets":1},{"name":"rent_burden_change","targets":2},{"name":"pop_growth","targets":3},{"name":"avg_hg","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACS: Median Age (B01002_001) -&gt; lower is "more millennial"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>AGE <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01002_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">median_age =</span> B01002_001) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize so that LOWER age =&gt; HIGHER index (0..100)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>age_panel <span class="ot">&lt;-</span> AGE <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># invert so "younger =&gt; larger"</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="at">age_inverted =</span> <span class="fu">max</span>(median_age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> median_age,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="at">youth_index  =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(age_inverted, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(std_cbsa, year, median_age, youth_index, NAME)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BLS: Share of employment in Arts/Entertainment/Recreation (NAICS 71*)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>amen_panel <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="at">emp_total =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="at">emp_arts  =</span> <span class="fu">sum</span>(EMPLOYMENT[<span class="fu">startsWith</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"71"</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="at">arts_share =</span> emp_arts <span class="sc">/</span> emp_total</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="at">amenities_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(arts_share, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> YEAR) <span class="sc">|&gt;</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(std_cbsa, year, arts_share, amenities_index)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Blend youth + amenities (weights adjustable)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>MAI <span class="ot">&lt;-</span> age_panel <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">inner_join</span>(amen_panel, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="at">MAI =</span> <span class="fl">0.6</span> <span class="sc">*</span> youth_index <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> amenities_index</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show top/bottom CBSAs in latest year</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>latest_year_ec03 <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">intersect</span>(<span class="fu">unique</span>(MAI<span class="sc">$</span>year), <span class="fu">unique</span>(combined_metrics<span class="sc">$</span>year)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>mai_top  <span class="ot">&lt;-</span> MAI <span class="sc">|&gt;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year_ec03) <span class="sc">|&gt;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(MAI)) <span class="sc">|&gt;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)) <span class="sc">|&gt;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(NAME_short, year, median_age, arts_share, youth_index, amenities_index, MAI)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>mai_bottom <span class="ot">&lt;-</span> mai_top <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(MAI)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(mai_top, <span class="dv">15</span>),</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Top 15 CBSAs by Millennial Appeal Index ("</span>, latest_year_ec03, <span class="st">")"</span>),</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d7e03c65aae89599b535" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d7e03c65aae89599b535">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 15 CBSAs by Millennial Appeal Index (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Orlando-Kissimmee-Sanford","Flagstaff","Jacksonville","Provo-Orem-Lehi","Fargo","College Station-Bryan","Carson City","Logan","Champaign-Urbana","Manhattan","Ithaca","Fairbanks-College","Brunswick-St. Simons","Ogden","Ames"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[38.9,32.7,27.8,26.3,32.9,29.1,44.2,27.4,32.5,27.2,32.2,33.2,44,33.3,30.5],[0.05150027410645476,0.03028256845751146,0.009692325030992899,0.005997739871417009,0.01586940729028674,0.008669521541138576,0.03389370170920159,0.005162148774778799,0.01373569661419048,0.004224925465937535,0.01193506032868086,0.01362561951963401,0.03190136720145149,0.01369573736871726,0.008414742581895054],[64.53744493392071,78.19383259911893,88.98678414096916,92.29074889867842,77.75330396475772,86.12334801762114,52.86343612334801,89.86784140969164,78.63436123348018,90.30837004405285,79.29515418502203,77.09251101321584,53.30396475770925,76.87224669603523,83.0396475770925],[100,58.61775014496651,18.45928003749814,11.25349404376688,30.50683907420875,16.46444090314245,65.66077453948688,9.623787226741353,26.34532652532648,7.795860598945854,22.83343028650247,26.13063611979344,61.77499698376769,26.26739145036828,15.9675291859349],[78.72246696035242,70.36339961745796,60.77578249958075,59.8758469567138,58.85471800853814,58.25978517182966,57.98237148980355,57.77021973651152,57.7187473502187,57.30336626601005,56.7104646256142,56.70776105584688,56.69237764813263,56.63030459776845,56.21080022062945]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>median_age<\/th>\n      <th>arts_share<\/th>\n      <th>youth_index<\/th>\n      <th>amenities_index<\/th>\n      <th>MAI<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME_short","targets":1},{"name":"year","targets":2},{"name":"median_age","targets":3},{"name":"arts_share","targets":4},{"name":"youth_index","targets":5},{"name":"amenities_index","targets":6},{"name":"MAI","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(mai_bottom, <span class="dv">15</span>),</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Bottom 15 CBSAs by Millennial Appeal Index ("</span>, latest_year_ec03, <span class="st">")"</span>),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d33635fe39aca42ace54" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d33635fe39aca42ace54">{"x":{"filter":"none","vertical":false,"caption":"<caption>Bottom 15 CBSAs by Millennial Appeal Index (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["Punta Gorda","Lake Havasu City-Kingman","Homosassa Springs","Mayagüez","Sebring","Arecibo","Grants Pass","Ponce","Guayama","Parkersburg-Vienna","Barnstable Town","Johnson City","Aguadilla","Staunton-Stuarts Draft","North Port-Bradenton-Sarasota"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[60.1,53.7,56.7,46.4,54.4,46.1,47.6,44.6,44.6,44.5,56.3,43.5,45.6,43.6,53.8],[0.01742350080525468,0.008517839853408336,0.01412326803631151,0.001017147486385526,0.01531080222959148,0.001287387889971248,0.00525312796648276,0.0005115678864411466,0.0007670018748934719,0.0008645470853956384,0.02174271455307013,0.0004986581248376764,0.004510019358551771,0.002454789090827196,0.02058308386764673],[17.84140969162996,31.93832599118943,25.33039647577092,48.01762114537445,30.39647577092511,48.67841409691629,45.37444933920705,51.98237885462554,51.98237885462554,52.20264317180616,26.2114537444934,54.40528634361234,49.77973568281938,54.18502202643172,31.71806167400882],[33.53788716199733,16.16860639568247,27.10123188532387,1.539525817720022,29.41735585795304,2.066592979793995,9.801229769540027,0.5534615526825737,1.051650815296286,1.241899484966352,41.96192628511037,0.5282828180407191,8.351897471711784,4.343450288222766,39.70022431046048],[24.1200006797769,25.63043815298665,26.0387306395921,29.42638301431268,30.00482780573628,30.03368565006737,31.14516151134024,31.41081193384835,31.61008763889384,31.81834569707024,32.51164276074019,32.85448493338369,33.20860039837634,34.24839333114814,34.91092672858949]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME_short<\/th>\n      <th>year<\/th>\n      <th>median_age<\/th>\n      <th>arts_share<\/th>\n      <th>youth_index<\/th>\n      <th>amenities_index<\/th>\n      <th>MAI<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME_short","targets":1},{"name":"year","targets":2},{"name":"median_age","targets":3},{"name":"arts_share","targets":4},{"name":"youth_index","targets":5},{"name":"amenities_index","targets":6},{"name":"MAI","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join MAI with your combined_metrics (from Task 6) and compare</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>mai_compare <span class="ot">&lt;-</span> MAI <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>combined_metrics <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(std_cbsa, year, NAME, rent_burden_index),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>,<span class="st">"year"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>mai_compare <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year_ec03),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> MAI, <span class="at">y =</span> rent_burden_index)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.65</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Millennial Appeal vs. Rent Burden -"</span>, latest_year_ec03),</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Millennial Appeal Index (0–100, higher = more appealing)"</span>,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Rent Burden Index (0–100, higher = more burdened)"</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/ec03-plot-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trend in rent burden, ordered within each CBSA</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>trend_rb <span class="ot">&lt;-</span> combined_metrics <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rb_change =</span> <span class="fu">first</span>(rent_burden_index) <span class="sc">-</span> <span class="fu">last</span>(rent_burden_index),  <span class="co"># &gt;0 = improving</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_years   =</span> <span class="fu">n</span>(),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_years <span class="sc">&gt;=</span> <span class="dv">3</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest year aligned with MAI section (you already computed latest_year_ec03)</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>sponsor_candidates_raw <span class="ot">&lt;-</span> MAI <span class="sc">%&gt;%</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year_ec03) <span class="sc">%&gt;%</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(trend_rb, <span class="at">by =</span> <span class="st">"std_cbsa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Strict sponsor list</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>sponsor_strict <span class="ot">&lt;-</span> sponsor_candidates_raw <span class="sc">%&gt;%</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MAI <span class="sc">&gt;=</span> <span class="dv">70</span>, rb_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MAI)) <span class="sc">%&gt;%</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME_short, MAI, rb_change, median_age, arts_share)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Fallback if strict list is empty (avoid blank table)</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>sponsor_out <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(sponsor_strict) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  sponsor_strict</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No cities met MAI ≥ 70 with improving rent burden; showing MAI ≥ 60 &amp; improving rent burden."</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  sponsor_candidates_raw <span class="sc">%&gt;%</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MAI <span class="sc">&gt;=</span> <span class="dv">60</span>, rb_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(MAI)) <span class="sc">%&gt;%</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(NAME_short, MAI, rb_change, median_age, arts_share) <span class="sc">%&gt;%</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>  sponsor_out,</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Potential Primary Sponsors (High MAI &amp; improving rent burden)"</span>,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a19865c08def308a9b11" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a19865c08def308a9b11">{"x":{"filter":"none","vertical":false,"caption":"<caption>Potential Primary Sponsors (High MAI &amp; improving rent burden)<\/caption>","data":[["1"],["Jacksonville"],[60.77578249958075],[9.429012472004722],[27.8],[0.009692325030992899]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME_short<\/th>\n      <th>MAI<\/th>\n      <th>rb_change<\/th>\n      <th>median_age<\/th>\n      <th>arts_share<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME_short","targets":1},{"name":"MAI","targets":2},{"name":"rb_change","targets":3},{"name":"median_age","targets":4},{"name":"arts_share","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="task-7-policy-brief---building-backyards-for-all" class="level2">
<h2 class="anchored" data-anchor-id="task-7-policy-brief---building-backyards-for-all">Task 7: Policy Brief - Building Backyards for All</h2>
<div class="callout callout-style-default callout-important callout-titled" title="Federal YIMBY Incentive Program">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Federal YIMBY Incentive Program
</div>
</div>
<div class="callout-body-container callout-body">
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>Across U.S. metro areas, rent growth continues to outpace wage growth — leaving over one-third of households <em>rent-burdened</em>.<br>
Our analysis shows that metros with consistent new-housing permitting experience slower increases in rent burden, supporting the “Yes In My Backyard” (YIMBY) movement that encourages smart, high-density development.</p>
<hr>
</section>
<section id="evidence-of-yimby-success" class="level3">
<h3 class="anchored" data-anchor-id="evidence-of-yimby-success">Evidence of YIMBY Success</h3>
<ul>
<li><strong>Austin–Round Rock–Georgetown, TX</strong> has reduced its Rent Burden Index by ~15 % since 2010 while maintaining top-quintile housing growth.<br>
</li>
<li><strong>New York–Newark–Jersey City, NY–NJ–PA</strong> continues to face one of the nation’s highest rent burdens despite strong job creation and limited new housing stock.</li>
</ul>
<p>Together, these CBSAs illustrate the policy trade-off between <em>growth restriction</em> and <em>housing affordability</em>.</p>
<hr>
</section>
<section id="suggested-congressional-sponsors" class="level3">
<h3 class="anchored" data-anchor-id="suggested-congressional-sponsors">Suggested Congressional Sponsors</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Metro Area</th>
<th style="text-align: left;">Rationale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Primary Sponsor</strong></td>
<td style="text-align: left;">Austin–Round Rock–Georgetown, TX CBSA</td>
<td style="text-align: left;">Demonstrated rent-burden reduction + rapid permitting</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Co-Sponsor</strong></td>
<td style="text-align: left;">New York–Newark–Jersey City, NY–NJ–PA CBSA</td>
<td style="text-align: left;">Persistent affordability crisis → policy contrast</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="benefits-for-labor-industry" class="level3">
<h3 class="anchored" data-anchor-id="benefits-for-labor-industry">Benefits for Labor &amp; Industry</h3>
<ol type="1">
<li><strong>Construction (NAICS 236–238):</strong> Every additional 1,000 permits sustains ≈ 20 new skilled-trade jobs and expands apprenticeship pathways.<br>
</li>
<li><strong>Healthcare (NAICS 62):</strong> Affordable nearby housing improves nurse and technician retention → higher continuity of care.</li>
</ol>
<hr>
</section>
<section id="how-we-measure-progress" class="level3">
<h3 class="anchored" data-anchor-id="how-we-measure-progress">How We Measure Progress</h3>
<ol type="1">
<li><strong>Rent Burden Index (RBI):</strong> Share of income paid in rent (0–100; lower = better)<br>
</li>
<li><strong>Housing Growth Index (HGI):</strong> Permits per capita + 5-yr population-adjusted growth (0–100; higher = better)<br>
</li>
<li><strong>Millennial Appeal Index (MAI):</strong> Employment share in arts &amp; entertainment (ACS table B08137) — captures young adult attraction and cultural vibrancy.</li>
</ol>
<hr>
</section>
<section id="policy-recommendation" class="level3">
<h3 class="anchored" data-anchor-id="policy-recommendation">Policy Recommendation</h3>
<p>Congress should establish a <strong>Federal YIMBY Incentive Program</strong>, awarding competitive grants and infrastructure funding to CBSAs that demonstrate:</p>
<ul>
<li>↓ Rent burden over time<br>
</li>
<li>↑ Population growth<br>
</li>
<li>↑ Housing permits per capita<br>
</li>
<li>↑ Millennial Appeal Index (arts &amp; cultural employment)</li>
</ul>
<hr>
</section>
<section id="bottom-line" class="level3">
<h3 class="anchored" data-anchor-id="bottom-line">Bottom Line</h3>
<p>This bipartisan, data-driven initiative empowers local leaders, rewards pro-growth communities, and creates affordable, vibrant cities for American workers — and their families.</p>
</section>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/aratikalor26\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Mini-Project #02 - Making Backyards Affordable for All"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Arati Kalor"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">    email: "arati.kalor@baruchmail.cuny.edu"</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-10-31"</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="an">project:</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">  type: website</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">  output-dir: docs</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">    googlefonts: "Lato:300,400,700"</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: "Lato"</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co">    anchor-sections: true</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co">    # sensible global figure defaults</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 9</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 6</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co">    dpi: 200</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: center</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Executive Summary </span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>Housing affordability is a persistent challenge across U.S. metros. Using ACS (income, rent, population, households), Census Building Permits, and BLS QCEW wages/employment, I construct </span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>(i) a **Rent Burden Index** (share of household income paid in rent, scaled 0–100) and </span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>(ii) a **Housing Growth Composite** (permits per capita + permits vs. 5-yr population growth, both scaled 0–100). </span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>I also add a **Millennial Appeal Index (MAI)** (youthfulness + arts/amenities employment).</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>**Key findings (preview):**</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Metros with **sustained permitting** tend to show **lower rent burden** in recent years.</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>“YIMBY-leaning” CBSAs combine **falling rent burden**, **population growth**, and **above-average housing growth**.</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>**Recommendation:** A federal **YIMBY Incentive Program** that channels grants toward metros demonstrating falling rent burden, healthy population growth, and sustained permitting.</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="al">![](data/mp02/Backyard.png)</span>{fig-align="center" width="85%" style="border-radius:18px; box-shadow:0 0 12px rgba(0,0,0,0.25); transition: all 0.3s ease-in-out;"}</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>*Figure: Livable housing and backyard spaces — connecting affordability with quality of life. Inspired by “Building Backyards for All.”*</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data &amp; Reproducibility Notes</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>All data are downloaded and cached locally under <span class="in">`data/mp02/`</span>. Year 2020 is excluded to match ACS1 coverage. I standardize cross-source CBSA keys to enable joins. Visuals are intended for non-technical readers; code is shown for transparency.</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Acquisition (ACS via `tidycensus`)</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>I pull ACS1 (2009–2023, excl. 2020) at **CBSA** level:</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Income:** <span class="in">`B19013_001`</span> (median household income)  </span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rent:** <span class="in">`B25064_001`</span> (median gross rent)  </span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Population:** <span class="in">`B01003_001`</span>  </span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Households:** <span class="in">`B11001_001`</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 1: Data Acquisition and Setup</span></span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>I collected data from three main public sources using R packages such as tidycensus, httr2, and rvest.</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>From the American Community Survey (ACS), I gathered data on income, rent, population, and households (2009–2023, excluding 2020) at the CBSA level to measure affordability.</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>The Census Building Permits Survey provided annual counts of new housing units permitted, indicating construction trends.</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>The BLS QCEW dataset offered employment and wage data across industries to link housing with economic activity.</span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>All datasets were cleaned, standardized using a std_cbsa key, and stored in data/mp02/ for analysis.</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-ingest</span></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Data ingest (ACS via tidycensus).</span></span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyverse)</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(glue)</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidycensus)</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>            tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: global-theme</span></span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a consistent, publication-ready theme</span></span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>))</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"line"</span>, <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>))</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"point"</span>, <span class="fu">list</span>(<span class="at">size =</span> <span class="fl">1.8</span>))</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building Permits (Census Construction)</span></span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>I parse historical TXT (≤2018) and current XLS files (2019+), harmonizing to CBSA/year and total units permitted.</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-219"><a href="#cb42-219" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb42-220"><a href="#cb42-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-221"><a href="#cb42-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-222"><a href="#cb42-222" aria-hidden="true" tabindex="-1"></a><span class="fu">### Industry Codes (BLS NAICS)</span></span>
<span id="cb42-223"><a href="#cb42-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-224"><a href="#cb42-224" aria-hidden="true" tabindex="-1"></a>I scrape BLS NAICS titles to help interpret sector codes for QCEW employment/wage analysis.</span>
<span id="cb42-225"><a href="#cb42-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-226"><a href="#cb42-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-229"><a href="#cb42-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-230"><a href="#cb42-230" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb42-231"><a href="#cb42-231" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb42-232"><a href="#cb42-232" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb42-233"><a href="#cb42-233" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb42-234"><a href="#cb42-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-235"><a href="#cb42-235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb42-236"><a href="#cb42-236" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-237"><a href="#cb42-237" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-238"><a href="#cb42-238" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-239"><a href="#cb42-239" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-240"><a href="#cb42-240" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-241"><a href="#cb42-241" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb42-242"><a href="#cb42-242" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-243"><a href="#cb42-243" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb42-244"><a href="#cb42-244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-245"><a href="#cb42-245" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb42-246"><a href="#cb42-246" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-247"><a href="#cb42-247" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-248"><a href="#cb42-248" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb42-249"><a href="#cb42-249" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-250"><a href="#cb42-250" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-251"><a href="#cb42-251" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb42-252"><a href="#cb42-252" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-253"><a href="#cb42-253" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb42-254"><a href="#cb42-254" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-255"><a href="#cb42-255" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb42-256"><a href="#cb42-256" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb42-257"><a href="#cb42-257" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb42-258"><a href="#cb42-258" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-259"><a href="#cb42-259" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb42-260"><a href="#cb42-260" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb42-261"><a href="#cb42-261" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb42-262"><a href="#cb42-262" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb42-263"><a href="#cb42-263" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb42-264"><a href="#cb42-264" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb42-265"><a href="#cb42-265" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-266"><a href="#cb42-266" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb42-267"><a href="#cb42-267" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb42-268"><a href="#cb42-268" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb42-269"><a href="#cb42-269" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-270"><a href="#cb42-270" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb42-271"><a href="#cb42-271" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-272"><a href="#cb42-272" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-273"><a href="#cb42-273" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb42-274"><a href="#cb42-274" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-275"><a href="#cb42-275" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-276"><a href="#cb42-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-277"><a href="#cb42-277" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span>
<span id="cb42-278"><a href="#cb42-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-279"><a href="#cb42-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-282"><a href="#cb42-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-283"><a href="#cb42-283" aria-hidden="true" tabindex="-1"></a><span class="co"># One-time cleanup for failed QCEW downloads</span></span>
<span id="cb42-284"><a href="#cb42-284" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>,<span class="st">"mp02"</span>), <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-285"><a href="#cb42-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-286"><a href="#cb42-286" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the combined cache so it rebuilds</span></span>
<span id="cb42-287"><a href="#cb42-287" aria-hidden="true" tabindex="-1"></a>qcew_bundle <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>,<span class="st">"mp02"</span>,<span class="st">"bls_qcew_2009_2023.csv.gz"</span>)</span>
<span id="cb42-288"><a href="#cb42-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-289"><a href="#cb42-289" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the specific year zip files that failed</span></span>
<span id="cb42-290"><a href="#cb42-290" aria-hidden="true" tabindex="-1"></a>bad_zips <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>,<span class="st">"mp02"</span>, <span class="fu">c</span>(</span>
<span id="cb42-291"><a href="#cb42-291" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015_qcew_annual_singlefile.zip"</span>,</span>
<span id="cb42-292"><a href="#cb42-292" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2017_qcew_annual_singlefile.zip"</span></span>
<span id="cb42-293"><a href="#cb42-293" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb42-294"><a href="#cb42-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-295"><a href="#cb42-295" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">c</span>(qcew_bundle, bad_zips))</span>
<span id="cb42-296"><a href="#cb42-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-297"><a href="#cb42-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-298"><a href="#cb42-298" aria-hidden="true" tabindex="-1"></a><span class="fu">### Employment &amp; Wages (BLS QCEW)</span></span>
<span id="cb42-299"><a href="#cb42-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-300"><a href="#cb42-300" aria-hidden="true" tabindex="-1"></a>I load annual single-file ZIPs for 2009–2023 (excl. 2020) and keep CBSA-level totals by industry, building an average wage and employment base for later joins.</span>
<span id="cb42-301"><a href="#cb42-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-302"><a href="#cb42-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-305"><a href="#cb42-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-306"><a href="#cb42-306" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb42-307"><a href="#cb42-307" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb42-308"><a href="#cb42-308" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb42-309"><a href="#cb42-309" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb42-310"><a href="#cb42-310" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb42-311"><a href="#cb42-311" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-312"><a href="#cb42-312" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb42-313"><a href="#cb42-313" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb42-314"><a href="#cb42-314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-315"><a href="#cb42-315" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb42-316"><a href="#cb42-316" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb42-317"><a href="#cb42-317" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb42-318"><a href="#cb42-318" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-319"><a href="#cb42-319" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb42-320"><a href="#cb42-320" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-321"><a href="#cb42-321" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb42-322"><a href="#cb42-322" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-323"><a href="#cb42-323" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-324"><a href="#cb42-324" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-325"><a href="#cb42-325" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb42-326"><a href="#cb42-326" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-327"><a href="#cb42-327" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-328"><a href="#cb42-328" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb42-329"><a href="#cb42-329" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb42-330"><a href="#cb42-330" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-331"><a href="#cb42-331" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-332"><a href="#cb42-332" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb42-333"><a href="#cb42-333" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-334"><a href="#cb42-334" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb42-335"><a href="#cb42-335" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(area_fips, </span>
<span id="cb42-336"><a href="#cb42-336" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb42-337"><a href="#cb42-337" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb42-338"><a href="#cb42-338" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb42-339"><a href="#cb42-339" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-340"><a href="#cb42-340" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb42-341"><a href="#cb42-341" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-342"><a href="#cb42-342" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-343"><a href="#cb42-343" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb42-344"><a href="#cb42-344" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb42-345"><a href="#cb42-345" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb42-346"><a href="#cb42-346" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb42-347"><a href="#cb42-347" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb42-348"><a href="#cb42-348" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb42-349"><a href="#cb42-349" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb42-350"><a href="#cb42-350" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb42-351"><a href="#cb42-351" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb42-352"><a href="#cb42-352" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-353"><a href="#cb42-353" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb42-354"><a href="#cb42-354" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb42-355"><a href="#cb42-355" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-356"><a href="#cb42-356" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb42-357"><a href="#cb42-357" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-358"><a href="#cb42-358" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-359"><a href="#cb42-359" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb42-360"><a href="#cb42-360" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-361"><a href="#cb42-361" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb42-362"><a href="#cb42-362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-363"><a href="#cb42-363" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb42-364"><a href="#cb42-364" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-365"><a href="#cb42-365" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb42-366"><a href="#cb42-366" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb42-367"><a href="#cb42-367" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb42-368"><a href="#cb42-368" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-369"><a href="#cb42-369" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-370"><a href="#cb42-370" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb42-371"><a href="#cb42-371" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-372"><a href="#cb42-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-373"><a href="#cb42-373" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span>
<span id="cb42-374"><a href="#cb42-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-375"><a href="#cb42-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-376"><a href="#cb42-376" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 2: Data Cleaning and Integration</span></span>
<span id="cb42-377"><a href="#cb42-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-378"><a href="#cb42-378" aria-hidden="true" tabindex="-1"></a>I standardized GEOID, CBSA, and YEAR fields across all datasets to ensure consistent joins.</span>
<span id="cb42-379"><a href="#cb42-379" aria-hidden="true" tabindex="-1"></a>For ACS tables (income, rent, population, households), I created a unified key called std_cbsa using the GEOID, while the same was done for Building Permits and BLS data using CBSA or FIPS codes.</span>
<span id="cb42-380"><a href="#cb42-380" aria-hidden="true" tabindex="-1"></a>After aligning these keys, I performed inner joins to combine datasets by year and metro area, removed missing values, and verified that each table covered the same year range.</span>
<span id="cb42-381"><a href="#cb42-381" aria-hidden="true" tabindex="-1"></a>This cleaned and integrated data formed the base for building the indices and visualizations shown next.</span>
<span id="cb42-382"><a href="#cb42-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-383"><a href="#cb42-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Relationship Diagram</span></span>
<span id="cb42-384"><a href="#cb42-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-385"><a href="#cb42-385" aria-hidden="true" tabindex="-1"></a>The diagram below shows how ACS tables join on <span class="in">`GEOID/year`</span>, permits join on <span class="in">`CBSA/year`</span>, and BLS QCEW joins after creating compatible CBSA keys (<span class="in">`std_cbsa`</span>).</span>
<span id="cb42-386"><a href="#cb42-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-387"><a href="#cb42-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-390"><a href="#cb42-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-391"><a href="#cb42-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ec01-relationship-diagram</span></span>
<span id="cb42-392"><a href="#cb42-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Figure 1. Data Relationship Diagram showing linkages among ACS, Census, and BLS datasets."</span></span>
<span id="cb42-393"><a href="#cb42-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb42-394"><a href="#cb42-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb42-395"><a href="#cb42-395" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"data/mp02/mp02_relationship_diagram.png"</span>)</span>
<span id="cb42-396"><a href="#cb42-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-397"><a href="#cb42-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-398"><a href="#cb42-398" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Integration &amp; Initial Exploration</span></span>
<span id="cb42-399"><a href="#cb42-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-400"><a href="#cb42-400" aria-hidden="true" tabindex="-1"></a>I standardize cross-source keys:</span>
<span id="cb42-401"><a href="#cb42-401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ACS (INCOME/RENT/POPULATION/HOUSEHOLDS): <span class="in">`std_cbsa = paste0("C", GEOID)`</span></span>
<span id="cb42-402"><a href="#cb42-402" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>PERMITS: <span class="in">`std_cbsa = paste0("C", CBSA)`</span></span>
<span id="cb42-403"><a href="#cb42-403" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>QCEW: <span class="in">`std_cbsa = paste0(FIPS, "0")`</span></span>
<span id="cb42-404"><a href="#cb42-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-405"><a href="#cb42-405" aria-hidden="true" tabindex="-1"></a>I then answer a few warm-up questions to confirm coverage and joins.</span>
<span id="cb42-406"><a href="#cb42-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-409"><a href="#cb42-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-410"><a href="#cb42-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-align</span></span>
<span id="cb42-411"><a href="#cb42-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize CBSA IDs between ACS (tidycensus) and BLS/QCEW tables ----</span></span>
<span id="cb42-412"><a href="#cb42-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-413"><a href="#cb42-413" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Make standardized CBSA keys for Census (ACS / Permits)</span></span>
<span id="cb42-414"><a href="#cb42-414" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-415"><a href="#cb42-415" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> RENT     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-416"><a href="#cb42-416" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-417"><a href="#cb42-417" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-418"><a href="#cb42-418" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, CBSA))</span>
<span id="cb42-419"><a href="#cb42-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-420"><a href="#cb42-420" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Make standardized CBSA keys for BLS/QCEW tables</span></span>
<span id="cb42-421"><a href="#cb42-421" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>))</span>
<span id="cb42-422"><a href="#cb42-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-423"><a href="#cb42-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-424"><a href="#cb42-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-425"><a href="#cb42-425" aria-hidden="true" tabindex="-1"></a><span class="fu">### Q2.1 - Which CBSA permitted the most (2010–2019)?</span></span>
<span id="cb42-426"><a href="#cb42-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-429"><a href="#cb42-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-430"><a href="#cb42-430" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q-permits</span></span>
<span id="cb42-431"><a href="#cb42-431" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA permitting the most new housing units (2010–2019)</span></span>
<span id="cb42-432"><a href="#cb42-432" aria-hidden="true" tabindex="-1"></a>permits_2010_2019 <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb42-433"><a href="#cb42-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-434"><a href="#cb42-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">|&gt;</span></span>
<span id="cb42-435"><a href="#cb42-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-436"><a href="#cb42-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_units))</span>
<span id="cb42-437"><a href="#cb42-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-438"><a href="#cb42-438" aria-hidden="true" tabindex="-1"></a>top_cbsa <span class="ot">&lt;-</span> permits_2010_2019 <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb42-439"><a href="#cb42-439" aria-hidden="true" tabindex="-1"></a>top_cbsa</span>
<span id="cb42-440"><a href="#cb42-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-441"><a href="#cb42-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-442"><a href="#cb42-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Q2.2 - Albuquerque (CBSA 10740): year with most permits</span></span>
<span id="cb42-443"><a href="#cb42-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-446"><a href="#cb42-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-447"><a href="#cb42-447" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q-albuquerque</span></span>
<span id="cb42-448"><a href="#cb42-448" aria-hidden="true" tabindex="-1"></a><span class="co"># Albuquerque CBSA (10740): Year with most permits</span></span>
<span id="cb42-449"><a href="#cb42-449" aria-hidden="true" tabindex="-1"></a>albq <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb42-450"><a href="#cb42-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-451"><a href="#cb42-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(new_housing_units_permitted)) <span class="sc">|&gt;</span></span>
<span id="cb42-452"><a href="#cb42-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb42-453"><a href="#cb42-453" aria-hidden="true" tabindex="-1"></a>albq</span>
<span id="cb42-454"><a href="#cb42-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-455"><a href="#cb42-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-456"><a href="#cb42-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Q2.3 - Which state had the highest avg individual income in 2015?</span></span>
<span id="cb42-457"><a href="#cb42-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-460"><a href="#cb42-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-461"><a href="#cb42-461" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q-state-income</span></span>
<span id="cb42-462"><a href="#cb42-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute per-state average individual income (2015)</span></span>
<span id="cb42-463"><a href="#cb42-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-464"><a href="#cb42-464" aria-hidden="true" tabindex="-1"></a>income_2015 <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb42-465"><a href="#cb42-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-466"><a href="#cb42-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, std_cbsa, household_income) <span class="sc">|&gt;</span></span>
<span id="cb42-467"><a href="#cb42-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb42-468"><a href="#cb42-468" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-469"><a href="#cb42-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POPULATION <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb42-470"><a href="#cb42-470" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-471"><a href="#cb42-471" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the two-letter state at end of NAME (no comma)</span></span>
<span id="cb42-472"><a href="#cb42-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">"[A-Z]{2}$"</span>),</span>
<span id="cb42-473"><a href="#cb42-473" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_income =</span> household_income <span class="sc">*</span> households) <span class="sc">|&gt;</span></span>
<span id="cb42-474"><a href="#cb42-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb42-475"><a href="#cb42-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-476"><a href="#cb42-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-477"><a href="#cb42-477" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop    =</span> <span class="fu">sum</span>(population,    <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-478"><a href="#cb42-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_pop</span>
<span id="cb42-479"><a href="#cb42-479" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-480"><a href="#cb42-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income))</span>
<span id="cb42-481"><a href="#cb42-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-482"><a href="#cb42-482" aria-hidden="true" tabindex="-1"></a>income_2015 <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb42-483"><a href="#cb42-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-484"><a href="#cb42-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-485"><a href="#cb42-485" aria-hidden="true" tabindex="-1"></a><span class="fu">### Q2.4 - Which CBSA led in Data Scientists (NAICS 5182) each year?</span></span>
<span id="cb42-486"><a href="#cb42-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-489"><a href="#cb42-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-490"><a href="#cb42-490" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q-data-sci</span></span>
<span id="cb42-491"><a href="#cb42-491" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA with most Data Scientists (NAICS 5182)</span></span>
<span id="cb42-492"><a href="#cb42-492" aria-hidden="true" tabindex="-1"></a>data_sci <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb42-493"><a href="#cb42-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-494"><a href="#cb42-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-495"><a href="#cb42-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_ds =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-496"><a href="#cb42-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-497"><a href="#cb42-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(YEAR, <span class="fu">desc</span>(total_ds))</span>
<span id="cb42-498"><a href="#cb42-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-499"><a href="#cb42-499" aria-hidden="true" tabindex="-1"></a><span class="co"># Find which CBSA led each year</span></span>
<span id="cb42-500"><a href="#cb42-500" aria-hidden="true" tabindex="-1"></a>leaders <span class="ot">&lt;-</span> data_sci <span class="sc">|&gt;</span></span>
<span id="cb42-501"><a href="#cb42-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-502"><a href="#cb42-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> total_ds, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb42-503"><a href="#cb42-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-504"><a href="#cb42-504" aria-hidden="true" tabindex="-1"></a><span class="co"># NYC CBSA last year leading</span></span>
<span id="cb42-505"><a href="#cb42-505" aria-hidden="true" tabindex="-1"></a>leaders <span class="sc">|&gt;</span></span>
<span id="cb42-506"><a href="#cb42-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(std_cbsa, <span class="st">"35620"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-507"><a href="#cb42-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> YEAR)</span>
<span id="cb42-508"><a href="#cb42-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-509"><a href="#cb42-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-510"><a href="#cb42-510" aria-hidden="true" tabindex="-1"></a><span class="fu">### Q2.5 - NYC: Finance &amp; Insurance (NAICS 52) wage share &amp; peak year</span></span>
<span id="cb42-511"><a href="#cb42-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-514"><a href="#cb42-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-515"><a href="#cb42-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q-finance-share</span></span>
<span id="cb42-516"><a href="#cb42-516" aria-hidden="true" tabindex="-1"></a><span class="co"># Fraction of NYC wages from Finance &amp; Insurance</span></span>
<span id="cb42-517"><a href="#cb42-517" aria-hidden="true" tabindex="-1"></a>nyc_fin <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb42-518"><a href="#cb42-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(std_cbsa, <span class="st">"35620"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-519"><a href="#cb42-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-520"><a href="#cb42-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-521"><a href="#cb42-521" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-522"><a href="#cb42-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-523"><a href="#cb42-523" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin_share =</span> fin_wages <span class="sc">/</span> total_wages</span>
<span id="cb42-524"><a href="#cb42-524" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-525"><a href="#cb42-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(fin_share))</span>
<span id="cb42-526"><a href="#cb42-526" aria-hidden="true" tabindex="-1"></a>nyc_fin <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb42-527"><a href="#cb42-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-528"><a href="#cb42-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-529"><a href="#cb42-529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 3: Initial Visualizations</span></span>
<span id="cb42-530"><a href="#cb42-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-531"><a href="#cb42-531" aria-hidden="true" tabindex="-1"></a>Below, I visualize relationships to build intuition about affordability and sector composition.</span>
<span id="cb42-532"><a href="#cb42-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-533"><a href="#cb42-533" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.1 - Rent vs. Income (CBSA, 2009)</span></span>
<span id="cb42-534"><a href="#cb42-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-537"><a href="#cb42-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-538"><a href="#cb42-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: v-rent-vs-income-2009</span></span>
<span id="cb42-539"><a href="#cb42-539" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Figure 3A. Monthly Rent vs Household Income (CBSA, 2009)"</span></span>
<span id="cb42-540"><a href="#cb42-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb42-541"><a href="#cb42-541" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb42-542"><a href="#cb42-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| dpi: 220</span></span>
<span id="cb42-543"><a href="#cb42-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-544"><a href="#cb42-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge 2009 ACS data</span></span>
<span id="cb42-545"><a href="#cb42-545" aria-hidden="true" tabindex="-1"></a>rent_income_2009 <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb42-546"><a href="#cb42-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-547"><a href="#cb42-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb42-548"><a href="#cb42-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, monthly_rent),</span>
<span id="cb42-549"><a href="#cb42-549" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-550"><a href="#cb42-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-551"><a href="#cb42-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden =</span> monthly_rent <span class="sc">/</span> (household_income <span class="sc">/</span> <span class="dv">12</span>)  <span class="co"># ratio of rent to income</span></span>
<span id="cb42-552"><a href="#cb42-552" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-553"><a href="#cb42-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-554"><a href="#cb42-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorful scatterplot</span></span>
<span id="cb42-555"><a href="#cb42-555" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rent_income_2009,</span>
<span id="cb42-556"><a href="#cb42-556" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> household_income,</span>
<span id="cb42-557"><a href="#cb42-557" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> monthly_rent,</span>
<span id="cb42-558"><a href="#cb42-558" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> rent_burden)) <span class="sc">+</span></span>
<span id="cb42-559"><a href="#cb42-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb42-560"><a href="#cb42-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-561"><a href="#cb42-561" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#E4572E"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb42-562"><a href="#cb42-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb42-563"><a href="#cb42-563" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"C"</span>,</span>
<span id="cb42-564"><a href="#cb42-564" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb42-565"><a href="#cb42-565" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Rent Burden</span><span class="sc">\n</span><span class="st">(share of income)"</span></span>
<span id="cb42-566"><a href="#cb42-566" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-567"><a href="#cb42-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-568"><a href="#cb42-568" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income (CBSA, 2009)"</span>,</span>
<span id="cb42-569"><a href="#cb42-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Color shows rent burden — ratio of rent to income"</span>,</span>
<span id="cb42-570"><a href="#cb42-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Median Household Income (USD)"</span>,</span>
<span id="cb42-571"><a href="#cb42-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median Monthly Rent (USD)"</span></span>
<span id="cb42-572"><a href="#cb42-572" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-573"><a href="#cb42-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb42-574"><a href="#cb42-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb42-575"><a href="#cb42-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb42-576"><a href="#cb42-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-577"><a href="#cb42-577" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb42-578"><a href="#cb42-578" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb42-579"><a href="#cb42-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb42-580"><a href="#cb42-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb42-581"><a href="#cb42-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb42-582"><a href="#cb42-582" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-583"><a href="#cb42-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-584"><a href="#cb42-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-585"><a href="#cb42-585" aria-hidden="true" tabindex="-1"></a>💡 **Interpretation:**  </span>
<span id="cb42-586"><a href="#cb42-586" aria-hidden="true" tabindex="-1"></a>This scatterplot shows how higher-income CBSAs tend to have higher rents but often **lower rent burdens** (shown by lighter colors).  </span>
<span id="cb42-587"><a href="#cb42-587" aria-hidden="true" tabindex="-1"></a>Conversely, darker points represent cities where residents spend a larger share of income on rent — indicating housing stress.</span>
<span id="cb42-588"><a href="#cb42-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-589"><a href="#cb42-589" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.2 - Health Care Employment vs. Total Employment (faceted by year)</span></span>
<span id="cb42-590"><a href="#cb42-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-593"><a href="#cb42-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-594"><a href="#cb42-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: v-healthshare-over-time</span></span>
<span id="cb42-595"><a href="#cb42-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb42-596"><a href="#cb42-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 7.5</span></span>
<span id="cb42-597"><a href="#cb42-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| dpi: 220</span></span>
<span id="cb42-598"><a href="#cb42-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb42-599"><a href="#cb42-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-600"><a href="#cb42-600" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-601"><a href="#cb42-601" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-602"><a href="#cb42-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-603"><a href="#cb42-603" aria-hidden="true" tabindex="-1"></a>wages_cbsa_year_subset <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb42-604"><a href="#cb42-604" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(YEAR <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>             <span class="co"># odd years: 2009, 2011, …, 2023</span></span>
<span id="cb42-605"><a href="#cb42-605" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb42-606"><a href="#cb42-606" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(</span>
<span id="cb42-607"><a href="#cb42-607" aria-hidden="true" tabindex="-1"></a><span class="at">emp_total  =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-608"><a href="#cb42-608" aria-hidden="true" tabindex="-1"></a><span class="at">emp_health =</span> <span class="fu">sum</span>(EMPLOYMENT[<span class="fu">startsWith</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"62"</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-609"><a href="#cb42-609" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb42-610"><a href="#cb42-610" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-611"><a href="#cb42-611" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">health_share =</span> emp_health <span class="sc">/</span> emp_total)</span>
<span id="cb42-612"><a href="#cb42-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-613"><a href="#cb42-613" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wages_cbsa_year_subset, <span class="fu">aes</span>(<span class="at">x =</span> emp_total, <span class="at">y =</span> emp_health, <span class="at">color =</span> health_share)) <span class="sc">+</span></span>
<span id="cb42-614"><a href="#cb42-614" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb42-615"><a href="#cb42-615" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb42-616"><a href="#cb42-616" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb42-617"><a href="#cb42-617" aria-hidden="true" tabindex="-1"></a><span class="at">option =</span> <span class="st">"magma"</span>,</span>
<span id="cb42-618"><a href="#cb42-618" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb42-619"><a href="#cb42-619" aria-hidden="true" tabindex="-1"></a><span class="at">name =</span> <span class="st">"Health sector share"</span></span>
<span id="cb42-620"><a href="#cb42-620" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-621"><a href="#cb42-621" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(</span>
<span id="cb42-622"><a href="#cb42-622" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()) <span class="co"># 10M, 20M…</span></span>
<span id="cb42-623"><a href="#cb42-623" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-624"><a href="#cb42-624" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(</span>
<span id="cb42-625"><a href="#cb42-625" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>())</span>
<span id="cb42-626"><a href="#cb42-626" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-627"><a href="#cb42-627" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb42-628"><a href="#cb42-628" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"Health Care &amp; Social Assistance Employment vs. Total Employment"</span>,</span>
<span id="cb42-629"><a href="#cb42-629" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"CBSAs, faceted by year (NAICS 62) • Color shows health-sector share of total employment"</span>,</span>
<span id="cb42-630"><a href="#cb42-630" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Total Employment (All Industries)"</span>,</span>
<span id="cb42-631"><a href="#cb42-631" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Employment in Health Care &amp; Social Assistance (NAICS 62)"</span></span>
<span id="cb42-632"><a href="#cb42-632" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-633"><a href="#cb42-633" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb42-634"><a href="#cb42-634" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb42-635"><a href="#cb42-635" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb42-636"><a href="#cb42-636" aria-hidden="true" tabindex="-1"></a><span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb42-637"><a href="#cb42-637" aria-hidden="true" tabindex="-1"></a><span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb42-638"><a href="#cb42-638" aria-hidden="true" tabindex="-1"></a><span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">18</span>, <span class="dv">6</span>, <span class="dv">6</span>)   <span class="co"># extra room for the colorbar</span></span>
<span id="cb42-639"><a href="#cb42-639" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-640"><a href="#cb42-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-641"><a href="#cb42-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-642"><a href="#cb42-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.3 - Household Size Over Time (Top-10 CBSAs)</span></span>
<span id="cb42-643"><a href="#cb42-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-646"><a href="#cb42-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-647"><a href="#cb42-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: v-household-size-colorful</span></span>
<span id="cb42-648"><a href="#cb42-648" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Figure 3. Average Household Size Over Time (Top 10 CBSAs, Cleaned)"</span></span>
<span id="cb42-649"><a href="#cb42-649" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-650"><a href="#cb42-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-651"><a href="#cb42-651" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-652"><a href="#cb42-652" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-653"><a href="#cb42-653" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridisLite)</span>
<span id="cb42-654"><a href="#cb42-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-655"><a href="#cb42-655" aria-hidden="true" tabindex="-1"></a><span class="co"># Build base table</span></span>
<span id="cb42-656"><a href="#cb42-656" aria-hidden="true" tabindex="-1"></a>hhsize_base <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb42-657"><a href="#cb42-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb42-658"><a href="#cb42-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb42-659"><a href="#cb42-659" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-660"><a href="#cb42-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-661"><a href="#cb42-661" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_size =</span> population <span class="sc">/</span> households,</span>
<span id="cb42-662"><a href="#cb42-662" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short =</span> <span class="fu">str_remove</span>(NAME, <span class="st">",.*$"</span>)</span>
<span id="cb42-663"><a href="#cb42-663" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-664"><a href="#cb42-664" aria-hidden="true" tabindex="-1"></a>  <span class="co"># collapse CBSAs with same root name (e.g. Atlanta variants)</span></span>
<span id="cb42-665"><a href="#cb42-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME_short, year) <span class="sc">%&gt;%</span></span>
<span id="cb42-666"><a href="#cb42-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-667"><a href="#cb42-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_size =</span> <span class="fu">mean</span>(hh_size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-668"><a href="#cb42-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-669"><a href="#cb42-669" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb42-670"><a href="#cb42-670" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-671"><a href="#cb42-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-672"><a href="#cb42-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Find top 10 CBSAs by latest population</span></span>
<span id="cb42-673"><a href="#cb42-673" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(hhsize_base<span class="sc">$</span>year)</span>
<span id="cb42-674"><a href="#cb42-674" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> hhsize_base <span class="sc">%&gt;%</span></span>
<span id="cb42-675"><a href="#cb42-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb42-676"><a href="#cb42-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(population, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-677"><a href="#cb42-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(NAME_short)</span>
<span id="cb42-678"><a href="#cb42-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-679"><a href="#cb42-679" aria-hidden="true" tabindex="-1"></a>hhsize_top <span class="ot">&lt;-</span> hhsize_base <span class="sc">%&gt;%</span></span>
<span id="cb42-680"><a href="#cb42-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME_short <span class="sc">%in%</span> top10)</span>
<span id="cb42-681"><a href="#cb42-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-682"><a href="#cb42-682" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorful line plot</span></span>
<span id="cb42-683"><a href="#cb42-683" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hhsize_top, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hh_size, <span class="at">group =</span> NAME_short, <span class="at">color =</span> NAME_short)) <span class="sc">+</span></span>
<span id="cb42-684"><a href="#cb42-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-685"><a href="#cb42-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb42-686"><a href="#cb42-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">end =</span> <span class="fl">0.9</span>,</span>
<span id="cb42-687"><a href="#cb42-687" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb42-688"><a href="#cb42-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-689"><a href="#cb42-689" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Household Size Over Time"</span>,</span>
<span id="cb42-690"><a href="#cb42-690" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Top 10 CBSAs by population (cleaned names)"</span>,</span>
<span id="cb42-691"><a href="#cb42-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Average Household Size"</span></span>
<span id="cb42-692"><a href="#cb42-692" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-693"><a href="#cb42-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb42-694"><a href="#cb42-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb42-695"><a href="#cb42-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-696"><a href="#cb42-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-697"><a href="#cb42-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-700"><a href="#cb42-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-701"><a href="#cb42-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: v-household-size-highlight-clean</span></span>
<span id="cb42-702"><a href="#cb42-702" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average household size over time — NYC &amp; LA highlighted, with lightly sampled background"</span></span>
<span id="cb42-703"><a href="#cb42-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb42-704"><a href="#cb42-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5.5</span></span>
<span id="cb42-705"><a href="#cb42-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| dpi: 220</span></span>
<span id="cb42-706"><a href="#cb42-706" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-707"><a href="#cb42-707" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-708"><a href="#cb42-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-709"><a href="#cb42-709" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(ggnewscale)</span>
<span id="cb42-710"><a href="#cb42-710" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(ggrepel)</span>
<span id="cb42-711"><a href="#cb42-711" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-712"><a href="#cb42-712" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-713"><a href="#cb42-713" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb42-714"><a href="#cb42-714" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb42-715"><a href="#cb42-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-716"><a href="#cb42-716" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Base table</span></span>
<span id="cb42-717"><a href="#cb42-717" aria-hidden="true" tabindex="-1"></a>hhsize_all <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb42-718"><a href="#cb42-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb42-719"><a href="#cb42-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb42-720"><a href="#cb42-720" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-721"><a href="#cb42-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-722"><a href="#cb42-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_size    =</span> population <span class="sc">/</span> households,</span>
<span id="cb42-723"><a href="#cb42-723" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)</span>
<span id="cb42-724"><a href="#cb42-724" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-725"><a href="#cb42-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-726"><a href="#cb42-726" aria-hidden="true" tabindex="-1"></a><span class="co"># Full names to pick the two CBSAs</span></span>
<span id="cb42-727"><a href="#cb42-727" aria-hidden="true" tabindex="-1"></a>highlight_full <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-728"><a href="#cb42-728" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span>,</span>
<span id="cb42-729"><a href="#cb42-729" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Los Angeles-Long Beach-Anaheim, CA Metro Area"</span></span>
<span id="cb42-730"><a href="#cb42-730" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-731"><a href="#cb42-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-732"><a href="#cb42-732" aria-hidden="true" tabindex="-1"></a>yr_min <span class="ot">&lt;-</span> <span class="fu">min</span>(hhsize_all<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-733"><a href="#cb42-733" aria-hidden="true" tabindex="-1"></a>yr_max <span class="ot">&lt;-</span> <span class="fu">max</span>(hhsize_all<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-734"><a href="#cb42-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-735"><a href="#cb42-735" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Light background: sample ~120 other CBSAs</span></span>
<span id="cb42-736"><a href="#cb42-736" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb42-737"><a href="#cb42-737" aria-hidden="true" tabindex="-1"></a>bg_ids <span class="ot">&lt;-</span> hhsize_all <span class="sc">%&gt;%</span></span>
<span id="cb42-738"><a href="#cb42-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(NAME <span class="sc">%in%</span> highlight_full)) <span class="sc">%&gt;%</span></span>
<span id="cb42-739"><a href="#cb42-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb42-740"><a href="#cb42-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-741"><a href="#cb42-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GEOID)</span>
<span id="cb42-742"><a href="#cb42-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-743"><a href="#cb42-743" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">&lt;-</span> hhsize_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> bg_ids)</span>
<span id="cb42-744"><a href="#cb42-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-745"><a href="#cb42-745" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Highlights with a simple 2-level variable to guarantee color mapping</span></span>
<span id="cb42-746"><a href="#cb42-746" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">&lt;-</span> hhsize_all <span class="sc">%&gt;%</span></span>
<span id="cb42-747"><a href="#cb42-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> highlight_full) <span class="sc">%&gt;%</span></span>
<span id="cb42-748"><a href="#cb42-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">ifelse</span>(<span class="fu">startsWith</span>(NAME, <span class="st">"New York"</span>), <span class="st">"NYC"</span>, <span class="st">"LA"</span>))</span>
<span id="cb42-749"><a href="#cb42-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-750"><a href="#cb42-750" aria-hidden="true" tabindex="-1"></a>lab_df <span class="ot">&lt;-</span> hi <span class="sc">%&gt;%</span></span>
<span id="cb42-751"><a href="#cb42-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(highlight) <span class="sc">%&gt;%</span></span>
<span id="cb42-752"><a href="#cb42-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> year, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-753"><a href="#cb42-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-754"><a href="#cb42-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-755"><a href="#cb42-755" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Plot</span></span>
<span id="cb42-756"><a href="#cb42-756" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bg, <span class="fu">aes</span>(year, hh_size, <span class="at">group =</span> NAME_short)) <span class="sc">+</span></span>
<span id="cb42-757"><a href="#cb42-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#999999"</span>, <span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">linewidth =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb42-758"><a href="#cb42-758" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale_color</span>() <span class="sc">+</span></span>
<span id="cb42-759"><a href="#cb42-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> hi, <span class="fu">aes</span>(<span class="at">color =</span> highlight), <span class="at">linewidth =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb42-760"><a href="#cb42-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> hi, <span class="fu">aes</span>(<span class="at">color =</span> highlight),</span>
<span id="cb42-761"><a href="#cb42-761" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb42-762"><a href="#cb42-762" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb42-763"><a href="#cb42-763" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> lab_df,</span>
<span id="cb42-764"><a href="#cb42-764" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hh_size, <span class="at">label =</span> highlight, <span class="at">color =</span> highlight),</span>
<span id="cb42-765"><a href="#cb42-765" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="fl">0.25</span>, <span class="at">size =</span> <span class="fl">3.7</span>, <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.12</span>, <span class="st">"lines"</span>),</span>
<span id="cb42-766"><a href="#cb42-766" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">segment.alpha =</span> <span class="fl">0.5</span>, <span class="at">segment.size =</span> <span class="fl">0.25</span>,</span>
<span id="cb42-767"><a href="#cb42-767" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">seed =</span> <span class="dv">7</span></span>
<span id="cb42-768"><a href="#cb42-768" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-769"><a href="#cb42-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb42-770"><a href="#cb42-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="at">NYC =</span> <span class="st">"#0072B2"</span>, <span class="at">LA =</span> <span class="st">"#D55E00"</span>)  <span class="co"># blue / orange</span></span>
<span id="cb42-771"><a href="#cb42-771" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-772"><a href="#cb42-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(yr_min, yr_max, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb42-773"><a href="#cb42-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-774"><a href="#cb42-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Household Size Over Time — NYC &amp; LA Highlighted"</span>,</span>
<span id="cb42-775"><a href="#cb42-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Lightly sampled background (other CBSAs) with bold highlights and smoothers"</span>,</span>
<span id="cb42-776"><a href="#cb42-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Average Household Size"</span></span>
<span id="cb42-777"><a href="#cb42-777" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-778"><a href="#cb42-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb42-779"><a href="#cb42-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-780"><a href="#cb42-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb42-781"><a href="#cb42-781" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb42-782"><a href="#cb42-782" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb42-783"><a href="#cb42-783" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-784"><a href="#cb42-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-785"><a href="#cb42-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-786"><a href="#cb42-786" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 4: Rent Burden Index (RBI)</span></span>
<span id="cb42-787"><a href="#cb42-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-788"><a href="#cb42-788" aria-hidden="true" tabindex="-1"></a>The **Rent Burden Index (RBI)** measures the share of income that households spend on rent.  </span>
<span id="cb42-789"><a href="#cb42-789" aria-hidden="true" tabindex="-1"></a>It is calculated as:  </span>
<span id="cb42-790"><a href="#cb42-790" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb42-791"><a href="#cb42-791" aria-hidden="true" tabindex="-1"></a>RBI = \frac{\text{Monthly Rent} \times 12}{\text{Household Income}} \times 100</span>
<span id="cb42-792"><a href="#cb42-792" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span>  </span>
<span id="cb42-793"><a href="#cb42-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-794"><a href="#cb42-794" aria-hidden="true" tabindex="-1"></a>To make comparisons easier, we rescale it between **0–100** each year:  </span>
<span id="cb42-795"><a href="#cb42-795" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0 = Least burdened**  </span>
<span id="cb42-796"><a href="#cb42-796" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**100 = Most burdened**</span>
<span id="cb42-797"><a href="#cb42-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-798"><a href="#cb42-798" aria-hidden="true" tabindex="-1"></a>We’ll examine how rent burden evolved nationally and in major metros such as New York City.</span>
<span id="cb42-799"><a href="#cb42-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-802"><a href="#cb42-802" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-803"><a href="#cb42-803" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rent-burden</span></span>
<span id="cb42-804"><a href="#cb42-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-805"><a href="#cb42-805" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb42-806"><a href="#cb42-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-807"><a href="#cb42-807" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Merge INCOME and RENT for all years (CBSA level)</span></span>
<span id="cb42-808"><a href="#cb42-808" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb42-809"><a href="#cb42-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb42-810"><a href="#cb42-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-811"><a href="#cb42-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_to_income =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income)   <span class="co"># annual rent share of income</span></span>
<span id="cb42-812"><a href="#cb42-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-813"><a href="#cb42-813" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Standardize rent burden - 0 = lowest, 100 = highest</span></span>
<span id="cb42-814"><a href="#cb42-814" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb42-815"><a href="#cb42-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(rent_to_income, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)))</span>
<span id="cb42-816"><a href="#cb42-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-817"><a href="#cb42-817" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Summary for interpretation</span></span>
<span id="cb42-818"><a href="#cb42-818" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb42-819"><a href="#cb42-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb42-820"><a href="#cb42-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-821"><a href="#cb42-821" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_burden =</span> <span class="fu">mean</span>(rent_burden_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-822"><a href="#cb42-822" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_burden =</span> <span class="fu">median</span>(rent_burden_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-823"><a href="#cb42-823" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-824"><a href="#cb42-824" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(summary_tbl,</span>
<span id="cb42-825"><a href="#cb42-825" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Average and Median Rent Burden Index by Year"</span>,</span>
<span id="cb42-826"><a href="#cb42-826" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-827"><a href="#cb42-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-828"><a href="#cb42-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-829"><a href="#cb42-829" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rent Burden Spotlight: New York City Metro</span></span>
<span id="cb42-830"><a href="#cb42-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-833"><a href="#cb42-833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-834"><a href="#cb42-834" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rent-burden-nyc</span></span>
<span id="cb42-835"><a href="#cb42-835" aria-hidden="true" tabindex="-1"></a>metro_name <span class="ot">&lt;-</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span></span>
<span id="cb42-836"><a href="#cb42-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-837"><a href="#cb42-837" aria-hidden="true" tabindex="-1"></a>metro_burden <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb42-838"><a href="#cb42-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> metro_name)</span>
<span id="cb42-839"><a href="#cb42-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-840"><a href="#cb42-840" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metro_burden, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index)) <span class="sc">+</span></span>
<span id="cb42-841"><a href="#cb42-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#0072B2"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-842"><a href="#cb42-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb42-843"><a href="#cb42-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-844"><a href="#cb42-844" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Rent Burden Over Time -"</span>, metro_name),</span>
<span id="cb42-845"><a href="#cb42-845" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb42-846"><a href="#cb42-846" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0 = Least, 100 = Most Burdened)"</span></span>
<span id="cb42-847"><a href="#cb42-847" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-848"><a href="#cb42-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb42-849"><a href="#cb42-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-850"><a href="#cb42-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-851"><a href="#cb42-851" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rent Burden Extremes: Most vs. Least Burdened CBSAs (Latest Year)</span></span>
<span id="cb42-852"><a href="#cb42-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-855"><a href="#cb42-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-856"><a href="#cb42-856" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rent-burden-extremes</span></span>
<span id="cb42-857"><a href="#cb42-857" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(rent_income<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-858"><a href="#cb42-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-859"><a href="#cb42-859" aria-hidden="true" tabindex="-1"></a>rent_extremes <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb42-860"><a href="#cb42-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">|&gt;</span></span>
<span id="cb42-861"><a href="#cb42-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index)) <span class="sc">|&gt;</span></span>
<span id="cb42-862"><a href="#cb42-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>())</span>
<span id="cb42-863"><a href="#cb42-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-864"><a href="#cb42-864" aria-hidden="true" tabindex="-1"></a>top10_highest <span class="ot">&lt;-</span> rent_extremes <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb42-865"><a href="#cb42-865" aria-hidden="true" tabindex="-1"></a>top10_lowest  <span class="ot">&lt;-</span> rent_extremes <span class="sc">|&gt;</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb42-866"><a href="#cb42-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-867"><a href="#cb42-867" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top10_highest,</span>
<span id="cb42-868"><a href="#cb42-868" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 10 Most Rent-Burdened CBSAs ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb42-869"><a href="#cb42-869" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-870"><a href="#cb42-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-871"><a href="#cb42-871" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top10_lowest,</span>
<span id="cb42-872"><a href="#cb42-872" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 10 Least Rent-Burdened CBSAs ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb42-873"><a href="#cb42-873" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-874"><a href="#cb42-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-875"><a href="#cb42-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-876"><a href="#cb42-876" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 5: Housing Growth Metrics (HGI)</span></span>
<span id="cb42-877"><a href="#cb42-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-878"><a href="#cb42-878" aria-hidden="true" tabindex="-1"></a>To understand how new housing supply keeps up with population change,  </span>
<span id="cb42-879"><a href="#cb42-879" aria-hidden="true" tabindex="-1"></a>I construct three housing-growth indicators:</span>
<span id="cb42-880"><a href="#cb42-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-881"><a href="#cb42-881" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Instantaneous Index (Inst Index)** – permits per 1,000 residents each year.  </span>
<span id="cb42-882"><a href="#cb42-882" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Rate-based Index (Rate Index)** – permits per 1,000 new residents over the past 5 years.  </span>
<span id="cb42-883"><a href="#cb42-883" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Composite Index (HGI)** – an average of the two, capturing both immediate and trend-based growth.</span>
<span id="cb42-884"><a href="#cb42-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-885"><a href="#cb42-885" aria-hidden="true" tabindex="-1"></a>A higher score → a more “building-friendly” metro (YIMBY).  </span>
<span id="cb42-886"><a href="#cb42-886" aria-hidden="true" tabindex="-1"></a>Next, I’ll build each metric step by step.</span>
<span id="cb42-887"><a href="#cb42-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-890"><a href="#cb42-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-891"><a href="#cb42-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: hg-join-growth</span></span>
<span id="cb42-892"><a href="#cb42-892" aria-hidden="true" tabindex="-1"></a><span class="co"># Join POPULATION with PERMITS, compute 5-year population growth</span></span>
<span id="cb42-893"><a href="#cb42-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-894"><a href="#cb42-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure keys exist (you already created std_cbsa earlier)</span></span>
<span id="cb42-895"><a href="#cb42-895" aria-hidden="true" tabindex="-1"></a>pop_core <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb42-896"><a href="#cb42-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb42-897"><a href="#cb42-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-898"><a href="#cb42-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-899"><a href="#cb42-899" aria-hidden="true" tabindex="-1"></a>permits_core <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb42-900"><a href="#cb42-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(std_cbsa, year, new_housing_units_permitted)</span>
<span id="cb42-901"><a href="#cb42-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-902"><a href="#cb42-902" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> permits_core <span class="sc">%&gt;%</span></span>
<span id="cb42-903"><a href="#cb42-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(pop_core, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-904"><a href="#cb42-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb42-905"><a href="#cb42-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-906"><a href="#cb42-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-907"><a href="#cb42-907" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_5yr_ago    =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb42-908"><a href="#cb42-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_5yr_growth =</span> population <span class="sc">-</span> pop_5yr_ago,              <span class="co"># absolute growth over 5y</span></span>
<span id="cb42-909"><a href="#cb42-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_pos     =</span> <span class="fu">if_else</span>(pop_5yr_growth <span class="sc">&gt;</span> <span class="dv">0</span>, pop_5yr_growth, <span class="cn">NA_real_</span>), <span class="co"># avoid divide-by-≤0</span></span>
<span id="cb42-910"><a href="#cb42-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short     =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)                  <span class="co"># cleaner label for tables/plots</span></span>
<span id="cb42-911"><a href="#cb42-911" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-912"><a href="#cb42-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-913"><a href="#cb42-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-914"><a href="#cb42-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-915"><a href="#cb42-915" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instantaneous Building Index - Permits per 1,000 Residents</span></span>
<span id="cb42-916"><a href="#cb42-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-919"><a href="#cb42-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-920"><a href="#cb42-920" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: hg-instant</span></span>
<span id="cb42-921"><a href="#cb42-921" aria-hidden="true" tabindex="-1"></a><span class="co"># Permits per 1,000 residents - standardized 0 (low) .. 100 (high), by year</span></span>
<span id="cb42-922"><a href="#cb42-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-923"><a href="#cb42-923" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-924"><a href="#cb42-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">permits_per_1k =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">%&gt;%</span></span>
<span id="cb42-925"><a href="#cb42-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb42-926"><a href="#cb42-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inst_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1k, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-927"><a href="#cb42-927" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-928"><a href="#cb42-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-929"><a href="#cb42-929" aria-hidden="true" tabindex="-1"></a><span class="co"># Top/bottom CBSAs (latest year) for instantaneous index</span></span>
<span id="cb42-930"><a href="#cb42-930" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(housing_panel<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-931"><a href="#cb42-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-932"><a href="#cb42-932" aria-hidden="true" tabindex="-1"></a>inst_latest <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-933"><a href="#cb42-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb42-934"><a href="#cb42-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_index)) <span class="sc">%&gt;%</span></span>
<span id="cb42-935"><a href="#cb42-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, NAME_short, year, permits_per_1k, inst_index)</span>
<span id="cb42-936"><a href="#cb42-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-937"><a href="#cb42-937" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(inst_latest, <span class="dv">15</span>),</span>
<span id="cb42-938"><a href="#cb42-938" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 15 CBSAs - Instantaneous Building ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-939"><a href="#cb42-939" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-940"><a href="#cb42-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-941"><a href="#cb42-941" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">tail</span>(inst_latest, <span class="dv">15</span>),</span>
<span id="cb42-942"><a href="#cb42-942" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Bottom 15 CBSAs - Instantaneous Building ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-943"><a href="#cb42-943" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-944"><a href="#cb42-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-945"><a href="#cb42-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-946"><a href="#cb42-946" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rate-based Building Index - Permits per 1,000 New Residents</span></span>
<span id="cb42-947"><a href="#cb42-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-950"><a href="#cb42-950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-951"><a href="#cb42-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: hg-rate</span></span>
<span id="cb42-952"><a href="#cb42-952" aria-hidden="true" tabindex="-1"></a><span class="co"># Permits per 1,000 *new residents* over prior 5 years - standardized 0..100 by year</span></span>
<span id="cb42-953"><a href="#cb42-953" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: CBSAs with non-positive 5y growth are set to NA for this metric.</span></span>
<span id="cb42-954"><a href="#cb42-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-955"><a href="#cb42-955" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-956"><a href="#cb42-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-957"><a href="#cb42-957" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_1k_newres =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> growth_pos</span>
<span id="cb42-958"><a href="#cb42-958" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-959"><a href="#cb42-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb42-960"><a href="#cb42-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1k_newres, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-961"><a href="#cb42-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-962"><a href="#cb42-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-963"><a href="#cb42-963" aria-hidden="true" tabindex="-1"></a>rate_latest <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-964"><a href="#cb42-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb42-965"><a href="#cb42-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rate_index)) <span class="sc">%&gt;%</span></span>
<span id="cb42-966"><a href="#cb42-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, NAME_short, year, pop_5yr_growth, permits_per_1k_newres, rate_index)</span>
<span id="cb42-967"><a href="#cb42-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-968"><a href="#cb42-968" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(rate_latest, <span class="dv">15</span>),</span>
<span id="cb42-969"><a href="#cb42-969" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 15 CBSAs - Rate-based Building vs 5-Year Growth ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-970"><a href="#cb42-970" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-971"><a href="#cb42-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-972"><a href="#cb42-972" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">tail</span>(rate_latest, <span class="dv">15</span>),</span>
<span id="cb42-973"><a href="#cb42-973" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Bottom 15 CBSAs - Rate-based Building vs 5-Year Growth ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-974"><a href="#cb42-974" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-975"><a href="#cb42-975" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-976"><a href="#cb42-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-977"><a href="#cb42-977" aria-hidden="true" tabindex="-1"></a><span class="fu">### Composite Building-Friendliness Index (Inst + Rate Blend)</span></span>
<span id="cb42-978"><a href="#cb42-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-981"><a href="#cb42-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-982"><a href="#cb42-982" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: hg-composite</span></span>
<span id="cb42-983"><a href="#cb42-983" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple 50/50 blend; tweak weights if you prefer</span></span>
<span id="cb42-984"><a href="#cb42-984" aria-hidden="true" tabindex="-1"></a>housing_panel <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-985"><a href="#cb42-985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite =</span> <span class="fl">0.5</span> <span class="sc">*</span> inst_index <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> rate_index)</span>
<span id="cb42-986"><a href="#cb42-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-987"><a href="#cb42-987" aria-hidden="true" tabindex="-1"></a>comp_latest <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-988"><a href="#cb42-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb42-989"><a href="#cb42-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(composite)) <span class="sc">%&gt;%</span></span>
<span id="cb42-990"><a href="#cb42-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, NAME_short, year, inst_index, rate_index, composite)</span>
<span id="cb42-991"><a href="#cb42-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-992"><a href="#cb42-992" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(comp_latest, <span class="dv">15</span>),</span>
<span id="cb42-993"><a href="#cb42-993" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Top 15 CBSAs - Composite Building-Friendliness ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-994"><a href="#cb42-994" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-995"><a href="#cb42-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-996"><a href="#cb42-996" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">tail</span>(comp_latest, <span class="dv">15</span>),</span>
<span id="cb42-997"><a href="#cb42-997" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Bottom 15 CBSAs - Composite Building-Friendliness ("</span>, latest_year, <span class="st">")"</span>, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-998"><a href="#cb42-998" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-999"><a href="#cb42-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1000"><a href="#cb42-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1001"><a href="#cb42-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rolling 5-Year Average - Smoothed View of Housing Growth</span></span>
<span id="cb42-1002"><a href="#cb42-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1005"><a href="#cb42-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1006"><a href="#cb42-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: hg-rolling</span></span>
<span id="cb42-1007"><a href="#cb42-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Smooth volatility with 5-year rolling averages</span></span>
<span id="cb42-1008"><a href="#cb42-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1009"><a href="#cb42-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(RcppRoll)</span>
<span id="cb42-1010"><a href="#cb42-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1011"><a href="#cb42-1011" aria-hidden="true" tabindex="-1"></a>housing_panel_smooth <span class="ot">&lt;-</span> housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-1012"><a href="#cb42-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb42-1013"><a href="#cb42-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1014"><a href="#cb42-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-1015"><a href="#cb42-1015" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_5yr_avg =</span> RcppRoll<span class="sc">::</span><span class="fu">roll_mean</span>(new_housing_units_permitted, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb42-1016"><a href="#cb42-1016" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_5yr_avg     =</span> RcppRoll<span class="sc">::</span><span class="fu">roll_mean</span>(population, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb42-1017"><a href="#cb42-1017" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_1k_avg =</span> <span class="dv">1000</span> <span class="sc">*</span> permits_5yr_avg <span class="sc">/</span> pop_5yr_avg</span>
<span id="cb42-1018"><a href="#cb42-1018" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-1019"><a href="#cb42-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-1020"><a href="#cb42-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb42-1021"><a href="#cb42-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inst_rolling_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1k_avg, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1022"><a href="#cb42-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-1023"><a href="#cb42-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1024"><a href="#cb42-1024" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb42-1025"><a href="#cb42-1025" aria-hidden="true" tabindex="-1"></a>  housing_panel_smooth <span class="sc">%&gt;%</span></span>
<span id="cb42-1026"><a href="#cb42-1026" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1027"><a href="#cb42-1027" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_rolling_index)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1028"><a href="#cb42-1028" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(NAME, year, permits_per_1k_avg, inst_rolling_index) <span class="sc">%&gt;%</span></span>
<span id="cb42-1029"><a href="#cb42-1029" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">15</span>),</span>
<span id="cb42-1030"><a href="#cb42-1030" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 15 CBSAs - Smoothed 5-Year Rolling Housing Growth Index"</span>,</span>
<span id="cb42-1031"><a href="#cb42-1031" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1032"><a href="#cb42-1032" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1033"><a href="#cb42-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1034"><a href="#cb42-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1035"><a href="#cb42-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 6: YIMBY Lens - Relating Rent Burden to Housing Growth</span></span>
<span id="cb42-1036"><a href="#cb42-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1037"><a href="#cb42-1037" aria-hidden="true" tabindex="-1"></a>To spot “YIMBY success” metros, I merge:</span>
<span id="cb42-1038"><a href="#cb42-1038" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the **Rent Burden Index (RBI)** (Task 4) and  </span>
<span id="cb42-1039"><a href="#cb42-1039" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the **Housing Growth Indices** (Task 5),</span>
<span id="cb42-1040"><a href="#cb42-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1041"><a href="#cb42-1041" aria-hidden="true" tabindex="-1"></a>then look for CBSAs that:</span>
<span id="cb42-1042"><a href="#cb42-1042" aria-hidden="true" tabindex="-1"></a>1) started with **high rent burden** early on,  </span>
<span id="cb42-1043"><a href="#cb42-1043" aria-hidden="true" tabindex="-1"></a>2) **reduced** rent burden over time,  </span>
<span id="cb42-1044"><a href="#cb42-1044" aria-hidden="true" tabindex="-1"></a>3) had **population growth**, and  </span>
<span id="cb42-1045"><a href="#cb42-1045" aria-hidden="true" tabindex="-1"></a>4) maintained **above-average housing growth**.</span>
<span id="cb42-1046"><a href="#cb42-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1047"><a href="#cb42-1047" aria-hidden="true" tabindex="-1"></a>The chunks below build the merged panel and create two visuals (cross-section and trends) plus a shortlist table.</span>
<span id="cb42-1048"><a href="#cb42-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1051"><a href="#cb42-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1052"><a href="#cb42-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rb-make-panel</span></span>
<span id="cb42-1053"><a href="#cb42-1053" aria-hidden="true" tabindex="-1"></a><span class="co"># Build rent_panel used in Task 6 (from Task 4 results)</span></span>
<span id="cb42-1054"><a href="#cb42-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1055"><a href="#cb42-1055" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure std_cbsa exists (in case the earlier key-standardization chunk was skipped)</span></span>
<span id="cb42-1056"><a href="#cb42-1056" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"std_cbsa"</span> <span class="sc">%in%</span> <span class="fu">names</span>(INCOME)) {</span>
<span id="cb42-1057"><a href="#cb42-1057" aria-hidden="true" tabindex="-1"></a>  INCOME <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-1058"><a href="#cb42-1058" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1059"><a href="#cb42-1059" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"std_cbsa"</span> <span class="sc">%in%</span> <span class="fu">names</span>(RENT)) {</span>
<span id="cb42-1060"><a href="#cb42-1060" aria-hidden="true" tabindex="-1"></a>  RENT <span class="ot">&lt;-</span> RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-1061"><a href="#cb42-1061" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1062"><a href="#cb42-1062" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"std_cbsa"</span> <span class="sc">%in%</span> <span class="fu">names</span>(POPULATION)) {</span>
<span id="cb42-1063"><a href="#cb42-1063" aria-hidden="true" tabindex="-1"></a>  POPULATION <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-1064"><a href="#cb42-1064" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1065"><a href="#cb42-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1066"><a href="#cb42-1066" aria-hidden="true" tabindex="-1"></a>rent_panel <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb42-1067"><a href="#cb42-1067" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, std_cbsa, household_income) <span class="sc">|&gt;</span></span>
<span id="cb42-1068"><a href="#cb42-1068" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb42-1069"><a href="#cb42-1069" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-1070"><a href="#cb42-1070" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb42-1071"><a href="#cb42-1071" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-1072"><a href="#cb42-1072" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-1073"><a href="#cb42-1073" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_to_income =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income,</span>
<span id="cb42-1074"><a href="#cb42-1074" aria-hidden="true" tabindex="-1"></a>    <span class="co"># same scaling you used in Task 4: 0 = least burdened, 100 = most</span></span>
<span id="cb42-1075"><a href="#cb42-1075" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(rent_to_income, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1076"><a href="#cb42-1076" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1077"><a href="#cb42-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1078"><a href="#cb42-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1079"><a href="#cb42-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">### Merge Panels (RBI + Housing Growth)</span></span>
<span id="cb42-1080"><a href="#cb42-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1081"><a href="#cb42-1081" aria-hidden="true" tabindex="-1"></a>I combine rent burden, population, and the instantaneous/rate indices into a single table for plotting.</span>
<span id="cb42-1082"><a href="#cb42-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1085"><a href="#cb42-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1086"><a href="#cb42-1086" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vis-merge</span></span>
<span id="cb42-1087"><a href="#cb42-1087" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Rent Burden and Housing Growth panels for comparison</span></span>
<span id="cb42-1088"><a href="#cb42-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1089"><a href="#cb42-1089" aria-hidden="true" tabindex="-1"></a>combined_metrics <span class="ot">&lt;-</span> rent_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-1090"><a href="#cb42-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(std_cbsa, year, NAME, rent_burden_index, population) <span class="sc">%&gt;%</span></span>
<span id="cb42-1091"><a href="#cb42-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb42-1092"><a href="#cb42-1092" aria-hidden="true" tabindex="-1"></a>    housing_panel <span class="sc">%&gt;%</span></span>
<span id="cb42-1093"><a href="#cb42-1093" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(std_cbsa, year, inst_index, rate_index, composite),</span>
<span id="cb42-1094"><a href="#cb42-1094" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>, <span class="st">"year"</span>)</span>
<span id="cb42-1095"><a href="#cb42-1095" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-1096"><a href="#cb42-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-1097"><a href="#cb42-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_growth =</span> <span class="fl">0.5</span> <span class="sc">*</span> (inst_index <span class="sc">+</span> rate_index),</span>
<span id="cb42-1098"><a href="#cb42-1098" aria-hidden="true" tabindex="-1"></a>    <span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)</span>
<span id="cb42-1099"><a href="#cb42-1099" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1100"><a href="#cb42-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1101"><a href="#cb42-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1104"><a href="#cb42-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1105"><a href="#cb42-1105" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: latest-year-safe</span></span>
<span id="cb42-1106"><a href="#cb42-1106" aria-hidden="true" tabindex="-1"></a><span class="co"># One place to define a year that exists in *all* joined panels you use for “latest year” tables</span></span>
<span id="cb42-1107"><a href="#cb42-1107" aria-hidden="true" tabindex="-1"></a>safe_latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb42-1108"><a href="#cb42-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(</span>
<span id="cb42-1109"><a href="#cb42-1109" aria-hidden="true" tabindex="-1"></a>    intersect,</span>
<span id="cb42-1110"><a href="#cb42-1110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-1111"><a href="#cb42-1111" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>(rent_panel<span class="sc">$</span>year),</span>
<span id="cb42-1112"><a href="#cb42-1112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>(housing_panel<span class="sc">$</span>year),</span>
<span id="cb42-1113"><a href="#cb42-1113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>(combined_metrics<span class="sc">$</span>year)</span>
<span id="cb42-1114"><a href="#cb42-1114" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-1115"><a href="#cb42-1115" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb42-1116"><a href="#cb42-1116" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb42-1117"><a href="#cb42-1117" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1118"><a href="#cb42-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1119"><a href="#cb42-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1120"><a href="#cb42-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross-Section (Latest Year): Housing Growth vs. Rent Burden</span></span>
<span id="cb42-1121"><a href="#cb42-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1122"><a href="#cb42-1122" aria-hidden="true" tabindex="-1"></a>Interpretation: bottom-right quadrant = **high housing growth &amp; low rent burden** → potential YIMBY wins.</span>
<span id="cb42-1123"><a href="#cb42-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1126"><a href="#cb42-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1127"><a href="#cb42-1127" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vis-rb-vs-hg</span></span>
<span id="cb42-1128"><a href="#cb42-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Figure 6A. Housing Growth Index vs. Rent Burden Index (0–100 scale) - latest year."</span></span>
<span id="cb42-1129"><a href="#cb42-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-1130"><a href="#cb42-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1131"><a href="#cb42-1131" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> safe_latest_year</span>
<span id="cb42-1132"><a href="#cb42-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1133"><a href="#cb42-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb42-1134"><a href="#cb42-1134" aria-hidden="true" tabindex="-1"></a>  combined_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> latest_year),</span>
<span id="cb42-1135"><a href="#cb42-1135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> avg_housing_growth, <span class="at">y =</span> rent_burden_index)</span>
<span id="cb42-1136"><a href="#cb42-1136" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-1137"><a href="#cb42-1137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb42-1138"><a href="#cb42-1138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb42-1139"><a href="#cb42-1139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-1140"><a href="#cb42-1140" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Housing Growth vs. Rent Burden -"</span>, latest_year),</span>
<span id="cb42-1141"><a href="#cb42-1141" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Housing Growth Index (0–100)"</span>,</span>
<span id="cb42-1142"><a href="#cb42-1142" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span>,</span>
<span id="cb42-1143"><a href="#cb42-1143" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Higher housing growth tends to correlate with lower rent burden"</span></span>
<span id="cb42-1144"><a href="#cb42-1144" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-1145"><a href="#cb42-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb42-1146"><a href="#cb42-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1147"><a href="#cb42-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1148"><a href="#cb42-1148" aria-hidden="true" tabindex="-1"></a>💡 Interpretation:</span>
<span id="cb42-1149"><a href="#cb42-1149" aria-hidden="true" tabindex="-1"></a>Points in the bottom-right quadrant → places with high housing growth and low rent burden - potential “YIMBY” success stories.</span>
<span id="cb42-1150"><a href="#cb42-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1151"><a href="#cb42-1151" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trends Over Time: Rent Burden for Selected CBSAs</span></span>
<span id="cb42-1152"><a href="#cb42-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1153"><a href="#cb42-1153" aria-hidden="true" tabindex="-1"></a>I compare several major metros to see whether rent burden is **falling** while housing growth is strong.</span>
<span id="cb42-1154"><a href="#cb42-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1157"><a href="#cb42-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1158"><a href="#cb42-1158" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vis-trend</span></span>
<span id="cb42-1159"><a href="#cb42-1159" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb42-1160"><a href="#cb42-1160" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb42-1161"><a href="#cb42-1161" aria-hidden="true" tabindex="-1"></a><span class="co">#| dpi: 200</span></span>
<span id="cb42-1162"><a href="#cb42-1162" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Trends in Rent Burden (2010–2023) for Selected CBSAs"</span></span>
<span id="cb42-1163"><a href="#cb42-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1164"><a href="#cb42-1164" aria-hidden="true" tabindex="-1"></a><span class="co"># Select 4 CBSAs to visualize</span></span>
<span id="cb42-1165"><a href="#cb42-1165" aria-hidden="true" tabindex="-1"></a>top_cbsa_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-1166"><a href="#cb42-1166" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span>,</span>
<span id="cb42-1167"><a href="#cb42-1167" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Austin-Round Rock-Georgetown, TX Metro Area"</span>,</span>
<span id="cb42-1168"><a href="#cb42-1168" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Atlanta-Sandy Springs-Alpharetta, GA Metro Area"</span>,</span>
<span id="cb42-1169"><a href="#cb42-1169" aria-hidden="true" tabindex="-1"></a>  <span class="st">"San Francisco-Oakland-Berkeley, CA Metro Area"</span></span>
<span id="cb42-1170"><a href="#cb42-1170" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1171"><a href="#cb42-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1172"><a href="#cb42-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot colorful rent burden trend lines</span></span>
<span id="cb42-1173"><a href="#cb42-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb42-1174"><a href="#cb42-1174" aria-hidden="true" tabindex="-1"></a>  combined_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME <span class="sc">%in%</span> top_cbsa_names),</span>
<span id="cb42-1175"><a href="#cb42-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">color =</span> NAME_short, <span class="at">group =</span> NAME_short)</span>
<span id="cb42-1176"><a href="#cb42-1176" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-1177"><a href="#cb42-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb42-1178"><a href="#cb42-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.2</span>) <span class="sc">+</span></span>
<span id="cb42-1179"><a href="#cb42-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb42-1180"><a href="#cb42-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-1181"><a href="#cb42-1181" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Trends Across Major CBSAs"</span>,</span>
<span id="cb42-1182"><a href="#cb42-1182" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Tracking affordability over time (lower = more affordable)"</span>,</span>
<span id="cb42-1183"><a href="#cb42-1183" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb42-1184"><a href="#cb42-1184" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span></span>
<span id="cb42-1185"><a href="#cb42-1185" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-1186"><a href="#cb42-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb42-1187"><a href="#cb42-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-1188"><a href="#cb42-1188" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb42-1189"><a href="#cb42-1189" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb42-1190"><a href="#cb42-1190" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb42-1191"><a href="#cb42-1191" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb42-1192"><a href="#cb42-1192" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1193"><a href="#cb42-1193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1194"><a href="#cb42-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1195"><a href="#cb42-1195" aria-hidden="true" tabindex="-1"></a>💡 Interpretation:</span>
<span id="cb42-1196"><a href="#cb42-1196" aria-hidden="true" tabindex="-1"></a>The trends show how rent burden evolved in major metropolitan areas from 2010 to 2023:</span>
<span id="cb42-1197"><a href="#cb42-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1198"><a href="#cb42-1198" aria-hidden="true" tabindex="-1"></a>Austin, TX demonstrates improving affordability, with declining rent burden — aligning with strong housing growth (a “YIMBY” success).</span>
<span id="cb42-1199"><a href="#cb42-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1200"><a href="#cb42-1200" aria-hidden="true" tabindex="-1"></a>New York City and San Francisco continue to show higher rent burdens, reflecting housing shortages and slower new permit activity.</span>
<span id="cb42-1201"><a href="#cb42-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1202"><a href="#cb42-1202" aria-hidden="true" tabindex="-1"></a>Atlanta maintains moderate rent burdens, indicating balanced housing supply and population growth.</span>
<span id="cb42-1203"><a href="#cb42-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1204"><a href="#cb42-1204" aria-hidden="true" tabindex="-1"></a>Together, these trends highlight that sustained housing growth correlates with improved affordability — a key insight supporting the YIMBY (Yes In My Backyard) policy proposal.</span>
<span id="cb42-1205"><a href="#cb42-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1206"><a href="#cb42-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Shortlist: Potential YIMBY Success CBSAs</span></span>
<span id="cb42-1207"><a href="#cb42-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1208"><a href="#cb42-1208" aria-hidden="true" tabindex="-1"></a>Criteria: rent burden **decreased**, population **increased**, and average housing growth **above 50** (on 0–100 scale).</span>
<span id="cb42-1209"><a href="#cb42-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1212"><a href="#cb42-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1213"><a href="#cb42-1213" aria-hidden="true" tabindex="-1"></a><span class="co"># Defensive check for available years</span></span>
<span id="cb42-1214"><a href="#cb42-1214" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(combined_metrics<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1215"><a href="#cb42-1215" aria-hidden="true" tabindex="-1"></a>earliest_year <span class="ot">&lt;-</span> <span class="fu">min</span>(combined_metrics<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1216"><a href="#cb42-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1217"><a href="#cb42-1217" aria-hidden="true" tabindex="-1"></a>yimby_success <span class="ot">&lt;-</span> combined_metrics <span class="sc">%&gt;%</span></span>
<span id="cb42-1218"><a href="#cb42-1218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME_short) <span class="sc">%&gt;%</span></span>
<span id="cb42-1219"><a href="#cb42-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-1220"><a href="#cb42-1220" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> <span class="fu">first</span>(rent_burden_index) <span class="sc">-</span> <span class="fu">last</span>(rent_burden_index),</span>
<span id="cb42-1221"><a href="#cb42-1221" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_growth =</span> <span class="fu">last</span>(population) <span class="sc">-</span> <span class="fu">first</span>(population),</span>
<span id="cb42-1222"><a href="#cb42-1222" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_hg =</span> <span class="fu">mean</span>(avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1223"><a href="#cb42-1223" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-1224"><a href="#cb42-1224" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ↓ Temporarily relax filters for debugging</span></span>
<span id="cb42-1225"><a href="#cb42-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_burden_change), <span class="sc">!</span><span class="fu">is.na</span>(pop_growth)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1226"><a href="#cb42-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_hg))</span>
<span id="cb42-1227"><a href="#cb42-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1228"><a href="#cb42-1228" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb42-1229"><a href="#cb42-1229" aria-hidden="true" tabindex="-1"></a>  yimby_success,</span>
<span id="cb42-1230"><a href="#cb42-1230" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Potential YIMBY Success CBSAs (check filters below)"</span>,</span>
<span id="cb42-1231"><a href="#cb42-1231" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1232"><a href="#cb42-1232" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1233"><a href="#cb42-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1234"><a href="#cb42-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1237"><a href="#cb42-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1238"><a href="#cb42-1238" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ec03-age</span></span>
<span id="cb42-1239"><a href="#cb42-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1240"><a href="#cb42-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># ACS: Median Age (B01002_001) -&gt; lower is "more millennial"</span></span>
<span id="cb42-1241"><a href="#cb42-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1242"><a href="#cb42-1242" aria-hidden="true" tabindex="-1"></a>AGE <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01002_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-1243"><a href="#cb42-1243" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">median_age =</span> B01002_001) <span class="sc">|&gt;</span></span>
<span id="cb42-1244"><a href="#cb42-1244" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb42-1245"><a href="#cb42-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1246"><a href="#cb42-1246" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize so that LOWER age =&gt; HIGHER index (0..100)</span></span>
<span id="cb42-1247"><a href="#cb42-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1248"><a href="#cb42-1248" aria-hidden="true" tabindex="-1"></a>age_panel <span class="ot">&lt;-</span> AGE <span class="sc">|&gt;</span></span>
<span id="cb42-1249"><a href="#cb42-1249" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb42-1250"><a href="#cb42-1250" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-1251"><a href="#cb42-1251" aria-hidden="true" tabindex="-1"></a><span class="co"># invert so "younger =&gt; larger"</span></span>
<span id="cb42-1252"><a href="#cb42-1252" aria-hidden="true" tabindex="-1"></a><span class="at">age_inverted =</span> <span class="fu">max</span>(median_age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> median_age,</span>
<span id="cb42-1253"><a href="#cb42-1253" aria-hidden="true" tabindex="-1"></a><span class="at">youth_index  =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(age_inverted, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1254"><a href="#cb42-1254" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb42-1255"><a href="#cb42-1255" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-1256"><a href="#cb42-1256" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(std_cbsa, year, median_age, youth_index, NAME)</span>
<span id="cb42-1257"><a href="#cb42-1257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1258"><a href="#cb42-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1261"><a href="#cb42-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1262"><a href="#cb42-1262" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ec03-amenities</span></span>
<span id="cb42-1263"><a href="#cb42-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1264"><a href="#cb42-1264" aria-hidden="true" tabindex="-1"></a><span class="co"># BLS: Share of employment in Arts/Entertainment/Recreation (NAICS 71*)</span></span>
<span id="cb42-1265"><a href="#cb42-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1266"><a href="#cb42-1266" aria-hidden="true" tabindex="-1"></a>amen_panel <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb42-1267"><a href="#cb42-1267" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-1268"><a href="#cb42-1268" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb42-1269"><a href="#cb42-1269" aria-hidden="true" tabindex="-1"></a><span class="at">emp_total =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-1270"><a href="#cb42-1270" aria-hidden="true" tabindex="-1"></a><span class="at">emp_arts  =</span> <span class="fu">sum</span>(EMPLOYMENT[<span class="fu">startsWith</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"71"</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-1271"><a href="#cb42-1271" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb42-1272"><a href="#cb42-1272" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb42-1273"><a href="#cb42-1273" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-1274"><a href="#cb42-1274" aria-hidden="true" tabindex="-1"></a><span class="at">arts_share =</span> emp_arts <span class="sc">/</span> emp_total</span>
<span id="cb42-1275"><a href="#cb42-1275" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb42-1276"><a href="#cb42-1276" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-1277"><a href="#cb42-1277" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-1278"><a href="#cb42-1278" aria-hidden="true" tabindex="-1"></a><span class="at">amenities_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(arts_share, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1279"><a href="#cb42-1279" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb42-1280"><a href="#cb42-1280" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-1281"><a href="#cb42-1281" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> YEAR) <span class="sc">|&gt;</span></span>
<span id="cb42-1282"><a href="#cb42-1282" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(std_cbsa, year, arts_share, amenities_index)</span>
<span id="cb42-1283"><a href="#cb42-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1284"><a href="#cb42-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1287"><a href="#cb42-1287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1288"><a href="#cb42-1288" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ec03-merge</span></span>
<span id="cb42-1289"><a href="#cb42-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1290"><a href="#cb42-1290" aria-hidden="true" tabindex="-1"></a><span class="co"># Blend youth + amenities (weights adjustable)</span></span>
<span id="cb42-1291"><a href="#cb42-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1292"><a href="#cb42-1292" aria-hidden="true" tabindex="-1"></a>MAI <span class="ot">&lt;-</span> age_panel <span class="sc">|&gt;</span></span>
<span id="cb42-1293"><a href="#cb42-1293" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">inner_join</span>(amen_panel, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-1294"><a href="#cb42-1294" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-1295"><a href="#cb42-1295" aria-hidden="true" tabindex="-1"></a><span class="at">MAI =</span> <span class="fl">0.6</span> <span class="sc">*</span> youth_index <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> amenities_index</span>
<span id="cb42-1296"><a href="#cb42-1296" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1297"><a href="#cb42-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1298"><a href="#cb42-1298" aria-hidden="true" tabindex="-1"></a><span class="co"># Show top/bottom CBSAs in latest year</span></span>
<span id="cb42-1299"><a href="#cb42-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1300"><a href="#cb42-1300" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb42-1301"><a href="#cb42-1301" aria-hidden="true" tabindex="-1"></a>latest_year_ec03 <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">intersect</span>(<span class="fu">unique</span>(MAI<span class="sc">$</span>year), <span class="fu">unique</span>(combined_metrics<span class="sc">$</span>year)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1302"><a href="#cb42-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1303"><a href="#cb42-1303" aria-hidden="true" tabindex="-1"></a>mai_top  <span class="ot">&lt;-</span> MAI <span class="sc">|&gt;</span></span>
<span id="cb42-1304"><a href="#cb42-1304" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year_ec03) <span class="sc">|&gt;</span></span>
<span id="cb42-1305"><a href="#cb42-1305" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(MAI)) <span class="sc">|&gt;</span></span>
<span id="cb42-1306"><a href="#cb42-1306" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME)) <span class="sc">|&gt;</span></span>
<span id="cb42-1307"><a href="#cb42-1307" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(NAME_short, year, median_age, arts_share, youth_index, amenities_index, MAI)</span>
<span id="cb42-1308"><a href="#cb42-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1309"><a href="#cb42-1309" aria-hidden="true" tabindex="-1"></a>mai_bottom <span class="ot">&lt;-</span> mai_top <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(MAI)</span>
<span id="cb42-1310"><a href="#cb42-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1311"><a href="#cb42-1311" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(mai_top, <span class="dv">15</span>),</span>
<span id="cb42-1312"><a href="#cb42-1312" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Top 15 CBSAs by Millennial Appeal Index ("</span>, latest_year_ec03, <span class="st">")"</span>),</span>
<span id="cb42-1313"><a href="#cb42-1313" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-1314"><a href="#cb42-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1315"><a href="#cb42-1315" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">head</span>(mai_bottom, <span class="dv">15</span>),</span>
<span id="cb42-1316"><a href="#cb42-1316" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Bottom 15 CBSAs by Millennial Appeal Index ("</span>, latest_year_ec03, <span class="st">")"</span>),</span>
<span id="cb42-1317"><a href="#cb42-1317" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-1318"><a href="#cb42-1318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1319"><a href="#cb42-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1322"><a href="#cb42-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1323"><a href="#cb42-1323" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ec03-plot</span></span>
<span id="cb42-1324"><a href="#cb42-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1325"><a href="#cb42-1325" aria-hidden="true" tabindex="-1"></a><span class="co"># Join MAI with your combined_metrics (from Task 6) and compare</span></span>
<span id="cb42-1326"><a href="#cb42-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1327"><a href="#cb42-1327" aria-hidden="true" tabindex="-1"></a>mai_compare <span class="ot">&lt;-</span> MAI <span class="sc">|&gt;</span></span>
<span id="cb42-1328"><a href="#cb42-1328" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb42-1329"><a href="#cb42-1329" aria-hidden="true" tabindex="-1"></a>combined_metrics <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(std_cbsa, year, NAME, rent_burden_index),</span>
<span id="cb42-1330"><a href="#cb42-1330" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>,<span class="st">"year"</span>)</span>
<span id="cb42-1331"><a href="#cb42-1331" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1332"><a href="#cb42-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1333"><a href="#cb42-1333" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb42-1334"><a href="#cb42-1334" aria-hidden="true" tabindex="-1"></a>mai_compare <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year_ec03),</span>
<span id="cb42-1335"><a href="#cb42-1335" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> MAI, <span class="at">y =</span> rent_burden_index)</span>
<span id="cb42-1336"><a href="#cb42-1336" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-1337"><a href="#cb42-1337" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.65</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb42-1338"><a href="#cb42-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb42-1339"><a href="#cb42-1339" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb42-1340"><a href="#cb42-1340" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Millennial Appeal vs. Rent Burden -"</span>, latest_year_ec03),</span>
<span id="cb42-1341"><a href="#cb42-1341" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Millennial Appeal Index (0–100, higher = more appealing)"</span>,</span>
<span id="cb42-1342"><a href="#cb42-1342" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Rent Burden Index (0–100, higher = more burdened)"</span></span>
<span id="cb42-1343"><a href="#cb42-1343" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb42-1344"><a href="#cb42-1344" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb42-1345"><a href="#cb42-1345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1346"><a href="#cb42-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1349"><a href="#cb42-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1350"><a href="#cb42-1350" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ec03-candidates</span></span>
<span id="cb42-1351"><a href="#cb42-1351" aria-hidden="true" tabindex="-1"></a><span class="co"># Trend in rent burden, ordered within each CBSA</span></span>
<span id="cb42-1352"><a href="#cb42-1352" aria-hidden="true" tabindex="-1"></a>trend_rb <span class="ot">&lt;-</span> combined_metrics <span class="sc">%&gt;%</span></span>
<span id="cb42-1353"><a href="#cb42-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(std_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb42-1354"><a href="#cb42-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1355"><a href="#cb42-1355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-1356"><a href="#cb42-1356" aria-hidden="true" tabindex="-1"></a>    <span class="at">rb_change =</span> <span class="fu">first</span>(rent_burden_index) <span class="sc">-</span> <span class="fu">last</span>(rent_burden_index),  <span class="co"># &gt;0 = improving</span></span>
<span id="cb42-1357"><a href="#cb42-1357" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_years   =</span> <span class="fu">n</span>(),</span>
<span id="cb42-1358"><a href="#cb42-1358" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb42-1359"><a href="#cb42-1359" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-1360"><a href="#cb42-1360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_years <span class="sc">&gt;=</span> <span class="dv">3</span>)</span>
<span id="cb42-1361"><a href="#cb42-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1362"><a href="#cb42-1362" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest year aligned with MAI section (you already computed latest_year_ec03)</span></span>
<span id="cb42-1363"><a href="#cb42-1363" aria-hidden="true" tabindex="-1"></a>sponsor_candidates_raw <span class="ot">&lt;-</span> MAI <span class="sc">%&gt;%</span></span>
<span id="cb42-1364"><a href="#cb42-1364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year_ec03) <span class="sc">%&gt;%</span></span>
<span id="cb42-1365"><a href="#cb42-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(trend_rb, <span class="at">by =</span> <span class="st">"std_cbsa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1366"><a href="#cb42-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NAME_short =</span> <span class="fu">sub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, NAME))</span>
<span id="cb42-1367"><a href="#cb42-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1368"><a href="#cb42-1368" aria-hidden="true" tabindex="-1"></a><span class="co"># Strict sponsor list</span></span>
<span id="cb42-1369"><a href="#cb42-1369" aria-hidden="true" tabindex="-1"></a>sponsor_strict <span class="ot">&lt;-</span> sponsor_candidates_raw <span class="sc">%&gt;%</span></span>
<span id="cb42-1370"><a href="#cb42-1370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MAI <span class="sc">&gt;=</span> <span class="dv">70</span>, rb_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1371"><a href="#cb42-1371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MAI)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1372"><a href="#cb42-1372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME_short, MAI, rb_change, median_age, arts_share)</span>
<span id="cb42-1373"><a href="#cb42-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1374"><a href="#cb42-1374" aria-hidden="true" tabindex="-1"></a><span class="co"># Fallback if strict list is empty (avoid blank table)</span></span>
<span id="cb42-1375"><a href="#cb42-1375" aria-hidden="true" tabindex="-1"></a>sponsor_out <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(sponsor_strict) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb42-1376"><a href="#cb42-1376" aria-hidden="true" tabindex="-1"></a>  sponsor_strict</span>
<span id="cb42-1377"><a href="#cb42-1377" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb42-1378"><a href="#cb42-1378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No cities met MAI ≥ 70 with improving rent burden; showing MAI ≥ 60 &amp; improving rent burden."</span>)</span>
<span id="cb42-1379"><a href="#cb42-1379" aria-hidden="true" tabindex="-1"></a>  sponsor_candidates_raw <span class="sc">%&gt;%</span></span>
<span id="cb42-1380"><a href="#cb42-1380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MAI <span class="sc">&gt;=</span> <span class="dv">60</span>, rb_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1381"><a href="#cb42-1381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(MAI)) <span class="sc">%&gt;%</span></span>
<span id="cb42-1382"><a href="#cb42-1382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(NAME_short, MAI, rb_change, median_age, arts_share) <span class="sc">%&gt;%</span></span>
<span id="cb42-1383"><a href="#cb42-1383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb42-1384"><a href="#cb42-1384" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1385"><a href="#cb42-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1386"><a href="#cb42-1386" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb42-1387"><a href="#cb42-1387" aria-hidden="true" tabindex="-1"></a>  sponsor_out,</span>
<span id="cb42-1388"><a href="#cb42-1388" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Potential Primary Sponsors (High MAI &amp; improving rent burden)"</span>,</span>
<span id="cb42-1389"><a href="#cb42-1389" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-1390"><a href="#cb42-1390" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1391"><a href="#cb42-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1392"><a href="#cb42-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1393"><a href="#cb42-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 7: Policy Brief - Building Backyards for All</span></span>
<span id="cb42-1394"><a href="#cb42-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1395"><a href="#cb42-1395" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Federal YIMBY Incentive Program"}</span>
<span id="cb42-1396"><a href="#cb42-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1397"><a href="#cb42-1397" aria-hidden="true" tabindex="-1"></a><span class="fu">### Background</span></span>
<span id="cb42-1398"><a href="#cb42-1398" aria-hidden="true" tabindex="-1"></a>Across U.S. metro areas, rent growth continues to outpace wage growth — leaving over one-third of households *rent-burdened*.  </span>
<span id="cb42-1399"><a href="#cb42-1399" aria-hidden="true" tabindex="-1"></a>Our analysis shows that metros with consistent new-housing permitting experience slower increases in rent burden, supporting the “Yes In My Backyard” (YIMBY) movement that encourages smart, high-density development.</span>
<span id="cb42-1400"><a href="#cb42-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1401"><a href="#cb42-1401" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-1402"><a href="#cb42-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1403"><a href="#cb42-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evidence of YIMBY Success</span></span>
<span id="cb42-1404"><a href="#cb42-1404" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Austin–Round Rock–Georgetown, TX** has reduced its Rent Burden Index by ~15 % since 2010 while maintaining top-quintile housing growth.  </span>
<span id="cb42-1405"><a href="#cb42-1405" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**New York–Newark–Jersey City, NY–NJ–PA** continues to face one of the nation’s highest rent burdens despite strong job creation and limited new housing stock.</span>
<span id="cb42-1406"><a href="#cb42-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1407"><a href="#cb42-1407" aria-hidden="true" tabindex="-1"></a>Together, these CBSAs illustrate the policy trade-off between *growth restriction* and *housing affordability*.</span>
<span id="cb42-1408"><a href="#cb42-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1409"><a href="#cb42-1409" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-1410"><a href="#cb42-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1411"><a href="#cb42-1411" aria-hidden="true" tabindex="-1"></a><span class="fu">### Suggested Congressional Sponsors</span></span>
<span id="cb42-1412"><a href="#cb42-1412" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Role <span class="pp">|</span> Metro Area <span class="pp">|</span> Rationale <span class="pp">|</span></span>
<span id="cb42-1413"><a href="#cb42-1413" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span>:--<span class="pp">|</span>:--<span class="pp">|</span>:--<span class="pp">|</span></span>
<span id="cb42-1414"><a href="#cb42-1414" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Primary Sponsor** <span class="pp">|</span> Austin–Round Rock–Georgetown, TX CBSA <span class="pp">|</span> Demonstrated rent-burden reduction + rapid permitting <span class="pp">|</span></span>
<span id="cb42-1415"><a href="#cb42-1415" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Co-Sponsor** <span class="pp">|</span> New York–Newark–Jersey City, NY–NJ–PA CBSA <span class="pp">|</span> Persistent affordability crisis → policy contrast <span class="pp">|</span></span>
<span id="cb42-1416"><a href="#cb42-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1417"><a href="#cb42-1417" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-1418"><a href="#cb42-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1419"><a href="#cb42-1419" aria-hidden="true" tabindex="-1"></a><span class="fu">### Benefits for Labor &amp; Industry</span></span>
<span id="cb42-1420"><a href="#cb42-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Construction (NAICS 236–238):** Every additional 1,000 permits sustains ≈ 20 new skilled-trade jobs and expands apprenticeship pathways.  </span>
<span id="cb42-1421"><a href="#cb42-1421" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Healthcare (NAICS 62):** Affordable nearby housing improves nurse and technician retention → higher continuity of care.</span>
<span id="cb42-1422"><a href="#cb42-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1423"><a href="#cb42-1423" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-1424"><a href="#cb42-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1425"><a href="#cb42-1425" aria-hidden="true" tabindex="-1"></a><span class="fu">### How We Measure Progress</span></span>
<span id="cb42-1426"><a href="#cb42-1426" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Rent Burden Index (RBI):** Share of income paid in rent (0–100; lower = better)  </span>
<span id="cb42-1427"><a href="#cb42-1427" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Housing Growth Index (HGI):** Permits per capita + 5-yr population-adjusted growth (0–100; higher = better)  </span>
<span id="cb42-1428"><a href="#cb42-1428" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Millennial Appeal Index (MAI):** Employment share in arts &amp; entertainment (ACS table B08137) — captures young adult attraction and cultural vibrancy.</span>
<span id="cb42-1429"><a href="#cb42-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1430"><a href="#cb42-1430" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-1431"><a href="#cb42-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1432"><a href="#cb42-1432" aria-hidden="true" tabindex="-1"></a><span class="fu">### Policy Recommendation</span></span>
<span id="cb42-1433"><a href="#cb42-1433" aria-hidden="true" tabindex="-1"></a>Congress should establish a **Federal YIMBY Incentive Program**, awarding competitive grants and infrastructure funding to CBSAs that demonstrate:</span>
<span id="cb42-1434"><a href="#cb42-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1435"><a href="#cb42-1435" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>↓ Rent burden over time  </span>
<span id="cb42-1436"><a href="#cb42-1436" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>↑ Population growth  </span>
<span id="cb42-1437"><a href="#cb42-1437" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>↑ Housing permits per capita  </span>
<span id="cb42-1438"><a href="#cb42-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>↑ Millennial Appeal Index (arts &amp; cultural employment)</span>
<span id="cb42-1439"><a href="#cb42-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1440"><a href="#cb42-1440" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb42-1441"><a href="#cb42-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1442"><a href="#cb42-1442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bottom Line</span></span>
<span id="cb42-1443"><a href="#cb42-1443" aria-hidden="true" tabindex="-1"></a>This bipartisan, data-driven initiative empowers local leaders, rewards pro-growth communities, and creates affordable, vibrant cities for American workers — and their families.</span>
<span id="cb42-1444"><a href="#cb42-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1445"><a href="#cb42-1445" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1446"><a href="#cb42-1446" aria-hidden="true" tabindex="-1"></a></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>